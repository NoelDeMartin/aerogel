import{g as Oe}from"./index-8KxY-9KE.js";var pe={exports:{}},ge;function Se(){return ge||(ge=1,function(we){we.exports=function(I){var b={};function a(p){if(b[p])return b[p].exports;var v=b[p]={i:p,l:!1,exports:{}};return I[p].call(v.exports,v,v.exports,a),v.l=!0,v.exports}return a.m=I,a.c=b,a.d=function(p,v,E){a.o(p,v)||Object.defineProperty(p,v,{enumerable:!0,get:E})},a.r=function(p){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(p,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(p,"__esModule",{value:!0})},a.t=function(p,v){if(v&1&&(p=a(p)),v&8||v&4&&typeof p=="object"&&p&&p.__esModule)return p;var E=Object.create(null);if(a.r(E),Object.defineProperty(E,"default",{enumerable:!0,value:p}),v&2&&typeof p!="string")for(var S in p)a.d(E,S,(function(w){return p[w]}).bind(null,S));return E},a.n=function(p){var v=p&&p.__esModule?function(){return p.default}:function(){return p};return a.d(v,"a",v),v},a.o=function(p,v){return Object.prototype.hasOwnProperty.call(p,v)},a.p="",a(a.s=0)}([function(I,b,a){a.r(b);var p=a(1);const v=new p.default;if(b.default=v,Object.getOwnPropertyNames(p.default.prototype).forEach(E=>{const S=v[E];typeof S=="function"&&(v[E]=S.bind(v))}),typeof window<"u")if("SolidAuthClient"in window)console.warn("Caution: multiple versions of solid-auth-client active.");else{let E=!1;Object.defineProperty(window,"SolidAuthClient",{enumerable:!0,get:()=>(E||(E=!0,console.warn("window.SolidAuthClient has been deprecated."),console.warn("Please use window.solid.auth instead.")),v)})}},function(I,b,a){a.r(b),a.d(b,"default",function(){return c});var p=a(2),v=a.n(p),E=a(3),S=a.n(E),w=a(4),f=a(81),u=a(8),r=a(9),e=a(6),i=a(11);function t(d,h){var g=Object.keys(d);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(d);h&&(O=O.filter(function(k){return Object.getOwnPropertyDescriptor(d,k).enumerable})),g.push.apply(g,O)}return g}function s(d){for(var h=1;h<arguments.length;h++){var g=arguments[h]!=null?arguments[h]:{};h%2?t(g,!0).forEach(function(O){v()(d,O,g[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(g)):t(g).forEach(function(O){Object.defineProperty(d,O,Object.getOwnPropertyDescriptor(g,O))})}return d}const l=fetch;class c extends S.a{constructor(){super(...arguments),v()(this,"_pendingSession",void 0)}fetch(h,g){return this.emit("request",Object(e.toUrlString)(h)),Object(w.authnFetch)(Object(r.defaultStorage)(),l,h,g)}login(h,g){return g=s({},P(Object(e.currentUrlNoParams)()),{},g),i.login(h,g)}async popupLogin(h){h=s({},P(),{},h),/https?:/.test(h.popupUri)||(h.popupUri=new URL(h.popupUri||"/.well-known/solid/login",window.location).toString()),h.callbackUri||(h.callbackUri=h.popupUri);const g=Object(f.openIdpPopup)(h.popupUri),O=await Object(f.obtainSession)(h.storage,g,h);return this.emit("login",O),this.emit("session",O),O}async currentSession(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Object(r.defaultStorage)(),g=this._pendingSession||await Object(u.getSession)(h);if(!g){try{this._pendingSession=i.currentSession(h),g=await this._pendingSession}catch(O){console.error(O)}g&&(await Object(u.saveSession)(h)(g),this.emit("login",g),this.emit("session",g)),delete this._pendingSession}return g}async trackSession(h){h(await this.currentSession()),this.on("session",h)}stopTrackSession(h){this.removeListener("session",h)}async logout(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Object(r.defaultStorage)();if(await Object(u.getSession)(h)){try{await i.logout(h,l),this.emit("logout"),this.emit("session",null)}catch(O){console.warn("Error logging out:"),console.error(O)}await Object(u.clearSession)(h)}}}function P(d){return{callbackUri:d?d.split("#")[0]:"",popupUri:"",storage:Object(r.defaultStorage)()}}},function(I,b){function a(p,v,E){return v in p?Object.defineProperty(p,v,{value:E,enumerable:!0,configurable:!0,writable:!0}):p[v]=E,p}I.exports=a},function(I,b,a){var p=typeof Reflect=="object"?Reflect:null,v=p&&typeof p.apply=="function"?p.apply:function(g,O,k){return Function.prototype.apply.call(g,O,k)},E;p&&typeof p.ownKeys=="function"?E=p.ownKeys:Object.getOwnPropertySymbols?E=function(g){return Object.getOwnPropertyNames(g).concat(Object.getOwnPropertySymbols(g))}:E=function(g){return Object.getOwnPropertyNames(g)};function S(h){console&&console.warn&&console.warn(h)}var w=Number.isNaN||function(g){return g!==g};function f(){f.init.call(this)}I.exports=f,f.EventEmitter=f,f.prototype._events=void 0,f.prototype._eventsCount=0,f.prototype._maxListeners=void 0;var u=10;Object.defineProperty(f,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(h){if(typeof h!="number"||h<0||w(h))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+h+".");u=h}}),f.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},f.prototype.setMaxListeners=function(g){if(typeof g!="number"||g<0||w(g))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+g+".");return this._maxListeners=g,this};function r(h){return h._maxListeners===void 0?f.defaultMaxListeners:h._maxListeners}f.prototype.getMaxListeners=function(){return r(this)},f.prototype.emit=function(g){for(var O=[],k=1;k<arguments.length;k++)O.push(arguments[k]);var C=g==="error",B=this._events;if(B!==void 0)C=C&&B.error===void 0;else if(!C)return!1;if(C){var J;if(O.length>0&&(J=O[0]),J instanceof Error)throw J;var $=new Error("Unhandled error."+(J?" ("+J.message+")":""));throw $.context=J,$}var q=B[g];if(q===void 0)return!1;if(typeof q=="function")v(q,this,O);else for(var K=q.length,W=c(q,K),k=0;k<K;++k)v(W[k],this,O);return!0};function e(h,g,O,k){var C,B,J;if(typeof O!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof O);if(B=h._events,B===void 0?(B=h._events=Object.create(null),h._eventsCount=0):(B.newListener!==void 0&&(h.emit("newListener",g,O.listener?O.listener:O),B=h._events),J=B[g]),J===void 0)J=B[g]=O,++h._eventsCount;else if(typeof J=="function"?J=B[g]=k?[O,J]:[J,O]:k?J.unshift(O):J.push(O),C=r(h),C>0&&J.length>C&&!J.warned){J.warned=!0;var $=new Error("Possible EventEmitter memory leak detected. "+J.length+" "+String(g)+" listeners added. Use emitter.setMaxListeners() to increase limit");$.name="MaxListenersExceededWarning",$.emitter=h,$.type=g,$.count=J.length,S($)}return h}f.prototype.addListener=function(g,O){return e(this,g,O,!1)},f.prototype.on=f.prototype.addListener,f.prototype.prependListener=function(g,O){return e(this,g,O,!0)};function i(){for(var h=[],g=0;g<arguments.length;g++)h.push(arguments[g]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,v(this.listener,this.target,h))}function t(h,g,O){var k={fired:!1,wrapFn:void 0,target:h,type:g,listener:O},C=i.bind(k);return C.listener=O,k.wrapFn=C,C}f.prototype.once=function(g,O){if(typeof O!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof O);return this.on(g,t(this,g,O)),this},f.prototype.prependOnceListener=function(g,O){if(typeof O!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof O);return this.prependListener(g,t(this,g,O)),this},f.prototype.removeListener=function(g,O){var k,C,B,J,$;if(typeof O!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof O);if(C=this._events,C===void 0)return this;if(k=C[g],k===void 0)return this;if(k===O||k.listener===O)--this._eventsCount===0?this._events=Object.create(null):(delete C[g],C.removeListener&&this.emit("removeListener",g,k.listener||O));else if(typeof k!="function"){for(B=-1,J=k.length-1;J>=0;J--)if(k[J]===O||k[J].listener===O){$=k[J].listener,B=J;break}if(B<0)return this;B===0?k.shift():P(k,B),k.length===1&&(C[g]=k[0]),C.removeListener!==void 0&&this.emit("removeListener",g,$||O)}return this},f.prototype.off=f.prototype.removeListener,f.prototype.removeAllListeners=function(g){var O,k,C;if(k=this._events,k===void 0)return this;if(k.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):k[g]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete k[g]),this;if(arguments.length===0){var B=Object.keys(k),J;for(C=0;C<B.length;++C)J=B[C],J!=="removeListener"&&this.removeAllListeners(J);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(O=k[g],typeof O=="function")this.removeListener(g,O);else if(O!==void 0)for(C=O.length-1;C>=0;C--)this.removeListener(g,O[C]);return this};function s(h,g,O){var k=h._events;if(k===void 0)return[];var C=k[g];return C===void 0?[]:typeof C=="function"?O?[C.listener||C]:[C]:O?d(C):c(C,C.length)}f.prototype.listeners=function(g){return s(this,g,!0)},f.prototype.rawListeners=function(g){return s(this,g,!1)},f.listenerCount=function(h,g){return typeof h.listenerCount=="function"?h.listenerCount(g):l.call(h,g)},f.prototype.listenerCount=l;function l(h){var g=this._events;if(g!==void 0){var O=g[h];if(typeof O=="function")return 1;if(O!==void 0)return O.length}return 0}f.prototype.eventNames=function(){return this._eventsCount>0?E(this._events):[]};function c(h,g){for(var O=new Array(g),k=0;k<g;++k)O[k]=h[k];return O}function P(h,g){for(;g+1<h.length;g++)h[g]=h[g+1];h.pop()}function d(h){for(var g=new Array(h.length),O=0;O<g.length;++O)g[O]=h[O].listener||h[O];return g}},function(I,b,a){a.r(b),a.d(b,"authnFetch",function(){return w}),a(5);var p=a(6),v=a(7),E=a(8),S=a(11);async function w(u,r,e,i){const t=await Object(E.getSession)(u);if(!t)return r(e,i);if(await f(u,e))return Object(S.fetchWithCredentials)(t,r,e,i);let s=await r(e,i);return s.status===401&&(await Object(v.updateHostFromResponse)(u)(s),await f(u,e)&&(s=Object(S.fetchWithCredentials)(t,r,e,i))),s}async function f(u,r){const e=await Object(v.getHost)(u)(Object(p.toUrlString)(r));return e!=null&&e.requiresAuth}},function(I,b){(function(){I.exports=window.fetch})()},function(I,b,a){a.r(b),a.d(b,"currentUrl",function(){return v}),a.d(b,"currentUrlNoParams",function(){return E}),a.d(b,"navigateTo",function(){return S}),a.d(b,"originOf",function(){return w}),a.d(b,"toUrlString",function(){return f});function p(){return typeof window<"u"?window.location:{href:"https://example.org/",pathname:"/",origin:"example.org"}}const v=()=>p().href,E=()=>p().origin+p().pathname,S=u=>{p().href=u},w=u=>new URL(u).origin,f=u=>(typeof u!="string"&&(u="url"in u?u.url:u.toString()),new URL(u,v()).toString())},function(I,b,a){a.r(b),a.d(b,"getHost",function(){return r}),a.d(b,"saveHost",function(){return e}),a.d(b,"updateHostFromResponse",function(){return i});var p=a(2),v=a.n(p),E=a(8),S=a(9),w=a(11);function f(t,s){var l=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);s&&(c=c.filter(function(P){return Object.getOwnPropertyDescriptor(t,P).enumerable})),l.push.apply(l,c)}return l}function u(t){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?f(l,!0).forEach(function(c){v()(t,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(l)):f(l).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(l,c))})}return t}function r(t){return async s=>{const{host:l}=new URL(s),c=await Object(E.getSession)(t);if(c&&l===new URL(c.idp).host)return{url:l,requiresAuth:!0};const{hosts:P}=await Object(S.getData)(t);return P&&P[l]}}function e(t){return async s=>{let{url:l,requiresAuth:c}=s;await Object(S.updateStorage)(t,P=>u({},P,{hosts:u({},P.hosts,{[l]:{requiresAuth:c}})}))}}function i(t){return async s=>{if(w.requiresAuth(s)){const{host:l}=new URL(s.url);await e(t)({url:l,requiresAuth:!0})}}}},function(I,b,a){a.r(b),a.d(b,"getSession",function(){return f}),a.d(b,"saveSession",function(){return u}),a.d(b,"clearSession",function(){return r});var p=a(2),v=a.n(p),E=a(9);function S(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);i&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),t.push.apply(t,s)}return t}function w(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?S(t,!0).forEach(function(s){v()(e,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):S(t).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(t,s))})}return e}async function f(e){return(await Object(E.getData)(e)).session||null}function u(e){return async i=>(await Object(E.updateStorage)(e,s=>w({},s,{session:i}))).session}async function r(e){await Object(E.updateStorage)(e,i=>w({},i,{session:null}))}},function(I,b,a){a.r(b),a.d(b,"NAMESPACE",function(){return p}),a.d(b,"defaultStorage",function(){return v}),a.d(b,"getData",function(){return E}),a.d(b,"updateStorage",function(){return S}),a.d(b,"asyncStorage",function(){return w}),a.d(b,"memStorage",function(){return f}),a.d(b,"ipcStorage",function(){return u}),a(10);const p="solid-auth-client",v=()=>{const r=typeof window<"u"&&"localStorage"in window;return w(r?window.localStorage:f())};async function E(r){let e,i;try{e=await r.getItem(p),i=JSON.parse(e||"{}")}catch(t){console.warn("Could not deserialize data:",e),console.error(t),i={}}return i}async function S(r,e){const i=await E(r),t=e(i);return await r.setItem(p,JSON.stringify(t)),t}function w(r){return{getItem:e=>Promise.resolve(r.getItem(e)),setItem:(e,i)=>Promise.resolve(r.setItem(e,i)),removeItem:e=>Promise.resolve(r.removeItem(e))}}const f=()=>{const r={};return{getItem:e=>typeof r[e]>"u"?null:r[e],setItem:(e,i)=>{r[e]=i},removeItem:e=>{delete r[e]}}};function u(r){return{getItem:e=>r.request("storage/getItem",e),setItem:(e,i)=>r.request("storage/setItem",e,i),removeItem:e=>r.request("storage/removeItem",e)}}},function(I,b,a){a.r(b),a.d(b,"Server",function(){return S}),a.d(b,"Client",function(){return w});var p=a(2),v=a.n(p);const E="solid-auth-client";class S{constructor(u,r,e){v()(this,"_clientWindow",void 0),v()(this,"_clientOrigin",void 0),v()(this,"_handler",void 0),v()(this,"_messageListener",void 0),this._clientWindow=u,this._clientOrigin=r,this._handler=e,this._messageListener=i=>this._handleMessage(i)}async _handleMessage(u){let{data:r,origin:e}=u;if(e!==this._clientOrigin){console.warn("solid-auth-client is listening to ".concat(this._clientOrigin," ")+"so ignored a message received from ".concat(e,"."));return}const i=r&&r[E];if(i&&i.method){const{id:t,method:s,args:l}=i,c=await this._handler(s,...l);this._clientWindow.postMessage({[E]:{id:t,ret:c}},this._clientOrigin)}}start(){window.addEventListener("message",this._messageListener)}stop(){window.removeEventListener("message",this._messageListener)}}class w{constructor(u,r){v()(this,"_serverWindow",void 0),v()(this,"_serverOrigin",void 0),this._serverWindow=u,this._serverOrigin=r}request(u){const r=Math.random();for(var e=arguments.length,i=new Array(e>1?e-1:0),t=1;t<e;t++)i[t-1]=arguments[t];return this._serverWindow.postMessage({[E]:{id:r,method:u,args:i}},this._serverOrigin),new Promise((s,l)=>{window.addEventListener("message",P);const c=setTimeout(()=>{l(new Error("Could not connect to main window.")),window.removeEventListener("message",P)},2e3);function P(d){let{data:h}=d;const g=h&&h[E];g&&g.id===r&&g.hasOwnProperty("ret")&&(s(g.ret),clearTimeout(c),window.removeEventListener("message",P))}})}}},function(I,b,a){a.r(b),a.d(b,"login",function(){return c}),a.d(b,"currentSession",function(){return P}),a.d(b,"logout",function(){return d}),a.d(b,"getRegisteredRp",function(){return h}),a.d(b,"requiresAuth",function(){return $}),a.d(b,"fetchWithCredentials",function(){return q});var p=a(12),v=a.n(p),E=a(2),S=a.n(E),w=a(14),f=a(18),u=a.n(f),r=a(80),e=a.n(r),i=a(6),t=a(9);function s(K,W){var A=Object.keys(K);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(K);W&&(R=R.filter(function(N){return Object.getOwnPropertyDescriptor(K,N).enumerable})),A.push.apply(A,R)}return A}function l(K){for(var W=1;W<arguments.length;W++){var A=arguments[W]!=null?arguments[W]:{};W%2?s(A,!0).forEach(function(R){S()(K,R,A[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(K,Object.getOwnPropertyDescriptors(A)):s(A).forEach(function(R){Object.defineProperty(K,R,Object.getOwnPropertyDescriptor(A,R))})}return K}async function c(K,W){try{const A=await h(K,W);return await B(W.storage),C(A,W)}catch(A){return console.warn("Error logging in with WebID-OIDC"),console.error(A),null}}async function P(){let K=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Object(t.defaultStorage)();try{const W=await g(K);if(!W)return null;const A=Object(i.currentUrl)();if(!/#(.*&)?access_token=/.test(A))return null;window.location.hash="",await J(K);const R=await Object(t.getData)(K),N=await W.validateResponse(A,R);return N?l({},N,{webId:N.idClaims.sub,idp:N.issuer}):null}catch(W){return console.warn("Error finding a WebID-OIDC session"),console.error(W),null}}async function d(K,W){const A=await g(K);if(A)try{await A.logout();try{await W("/.well-known/solid/logout",{credentials:"include"})}catch{}}catch(R){console.warn("Error logging out of the WebID-OIDC session"),console.error(R)}}async function h(K,W){let A=await g(W.storage);return(!A||A.provider.url!==K||!A.registration.redirect_uris.includes(W.callbackUri))&&(A=await k(K,W),await O(W.storage,K,A)),A}async function g(K){const W=await Object(t.getData)(K),{rpConfig:A}=W;return A?(A.store=K,u.a.from(A)):null}async function O(K,W,A){return await Object(t.updateStorage)(K,R=>l({},R,{rpConfig:A})),A}function k(K,W){const{storage:A,callbackUri:R}=W,N="id_token token",x={};Object.entries(W).filter(ee=>{let[se,ie]=ee;return se.startsWith("clientName#")}).forEach(ee=>{let[se,ie]=ee;return x[se.replace("clientName#","client_name#")]=ie});const z={logo_uri:W.logoUri,contacts:W.contacts,client_name:W.clientName},ne=l({issuer:K,grant_types:["implicit"],redirect_uris:[R],response_types:[N],scope:"openid profile"},x,{},z),re={defaults:{authenticate:{redirect_uri:R,response_type:N}},store:A};return u.a.register(K,ne,re)}async function C(K,W){let{callbackUri:A,storage:R}=W;const N=await Object(t.getData)(R),x=await K.createRequest({redirect_uri:A},N);return await Object(t.updateStorage)(R,()=>N),Object(i.navigateTo)(x)}async function B(K){await Object(t.updateStorage)(K,W=>l({},W,{appHashFragment:window.location.hash}))}async function J(K){await Object(t.updateStorage)(K,W=>{let{appHashFragment:A=""}=W,R=v()(W,["appHashFragment"]);return window.location.hash=A,R})}function $(K){if(K.status!==401)return!1;const W=K.headers.get("www-authenticate");if(!W)return!1;const A=w.parse(W);return A.scheme==="Bearer"&&A.params&&A.params.scope==="openid webid"}async function q(K,W,A,R){const N={},x=R?R.headers:A.headers;if(x){const ne=typeof x.entries=="function"?x.entries():Object.entries(x);for(const[re,ee]of ne)N[re]=ee}const z=await e.a.issueFor(Object(i.toUrlString)(A),K);return N.authorization="Bearer ".concat(z),W(A,l({},R,{credentials:"include",headers:N}))}},function(I,b,a){var p=a(13);function v(E,S){if(E==null)return{};var w=p(E,S),f,u;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(E);for(u=0;u<r.length;u++)f=r[u],!(S.indexOf(f)>=0)&&Object.prototype.propertyIsEnumerable.call(E,f)&&(w[f]=E[f])}return w}I.exports=v},function(I,b){function a(p,v){if(p==null)return{};var E={},S=Object.keys(p),w,f;for(f=0;f<S.length;f++)w=S[f],!(v.indexOf(w)>=0)&&(E[w]=p[w]);return E}I.exports=a},function(I,b,a){Object.defineProperty(b,"__esModule",{value:!0}),Object.defineProperty(b,"format",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(b,"parse",{enumerable:!0,get:function(){return v.default}});var p=E(a(15)),v=E(a(17));function E(S){return S&&S.__esModule?S:{default:S}}},function(I,b,a){Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var p=a(16);function v(c){return w(c)||S(c)||E()}function E(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function S(c){if(Symbol.iterator in Object(c)||Object.prototype.toString.call(c)==="[object Arguments]")return Array.from(c)}function w(c){if(Array.isArray(c)){for(var P=0,d=new Array(c.length);P<c.length;P++)d[P]=c[P];return d}}function f(c,P){return e(c)||r(c,P)||u()}function u(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function r(c,P){var d=[],h=!0,g=!1,O=void 0;try{for(var k=c[Symbol.iterator](),C;!(h=(C=k.next()).done)&&(d.push(C.value),!(P&&d.length===P));h=!0);}catch(B){g=!0,O=B}finally{try{!h&&k.return!=null&&k.return()}finally{if(g)throw O}}return d}function e(c){if(Array.isArray(c))return c}var i=function(P){return function(d){return`${P}=${d&&!(0,p.isToken)(d)?(0,p.quote)(d):d}`}},t=function(P){return P.reduce(function(d,h){var g=f(h,2),O=g[0],k=g[1],C=i(O);if(!(0,p.isToken)(O))throw new TypeError;return Array.isArray(k)?v(d).concat(v(k.map(C))):v(d).concat([C(k)])},[])},s=function c(P,d){if(Array.isArray(P))return t(P);if(typeof P=="object"){var h=P;return c(Object.keys(P).map(function(g){return[g,h[g]]}))}throw new TypeError},l=function(P,d,h){var g=typeof P=="string"?{scheme:P,token:d,params:h}:P;if(typeof g!="object")throw new TypeError;if(!(0,p.isScheme)(g.scheme))throw new TypeError("Invalid scheme.");return[g.scheme].concat(v(typeof g.token<"u"?[g.token]:[]),v(typeof g.params<"u"?s(g.params):[])).join(" ")};b.default=l},function(I,b,a){Object.defineProperty(b,"__esModule",{value:!0}),b.unquote=b.quote=b.isScheme=b.isToken=void 0;var p=/^[^\u0000-\u001F\u007F()<>@,;:\\"/?={}\[\]\u0020\u0009]+$/,v=function(u){return typeof u=="string"&&p.test(u)};b.isToken=v;var E=v;b.isScheme=E;var S=function(u){return`"${u.replace(/"/g,'\\"')}"`};b.quote=S;var w=function(u){return u.substr(1,u.length-2).replace(/\\"/g,'"')};b.unquote=w},function(I,b,a){Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var p=a(16),v=/((?:[a-zA-Z0-9._~+\/-]+=*(?:\s+|$))|[^\u0000-\u001F\u007F()<>@,;:\\"/?={}\[\]\u0020\u0009]+)(?:=([^\\"=\s,]+|"(?:[^"\\]|\\.)*"))?/g,E=function(u,r){var e=r.charAt(0)==='"'?(0,p.unquote)(r):r.trim();return Array.isArray(u)?u.concat(e):typeof u=="string"?[u,e]:e},S=function(u,r){for(var e=null,i={};;){var t=v.exec(r);if(t===null)break;t[2]?i[t[1]]=E(i[t[1]],t[2]):e=E(e,t[1])}return{scheme:u,params:i,token:e}},w=function(u){if(typeof u!="string")throw new TypeError("Header value must be a string.");var r=u.indexOf(" "),e=u.substr(0,r);if(!(0,p.isScheme)(e))throw new TypeError(`Invalid scheme ${e}`);return S(e,u.substr(r))};b.default=w},function(I,b,a){I.exports=a(19)},function(I,b,a){(function(p){const v=a(21),E=a(5),{URL:S}=a(27),w=E.Headers?E.Headers:p.Headers,{JSONDocument:f}=a(28),{JWKSet:u}=a(37),r=a(68),e=a(70),i=a(79),t=a(74),s=a(69);class l extends f{static get schema(){return i}static from(d){let h=new l(d),g=h.validate();if(!g.valid)return Promise.reject(new Error(JSON.stringify(g)));let O=h.provider.jwks;return O?u.importKeys(O).then(k=>(h.provider.jwks=k,h)):h.jwks().then(()=>h)}static register(d,h,g){let O=new l({provider:{url:d},defaults:Object.assign({},g.defaults),store:g.store});return Promise.resolve().then(()=>O.discover()).then(()=>O.jwks()).then(()=>O.register(h)).then(()=>O)}discover(){try{let d=this.provider.url;v(d,'RelyingParty provider must define "url"');let h=new S(d);return h.pathname=".well-known/openid-configuration",E(h.toString()).then(t("Error fetching openid configuration")).then(g=>g.json().then(O=>this.provider.configuration=O))}catch(d){return Promise.reject(d)}}register(d){try{let h=this.provider.configuration;v(h,"OpenID Configuration is not initialized."),v(h.registration_endpoint,"OpenID Configuration is missing registration_endpoint.");let g=h.registration_endpoint,O="post",k=new w({"Content-Type":"application/json"}),C=this.defaults.register,B=JSON.stringify(Object.assign({},C,d));return E(g,{method:O,headers:k,body:B}).then(t("Error registering client")).then(J=>J.json().then($=>this.registration=$))}catch(h){return Promise.reject(h)}}serialize(){return JSON.stringify(this)}jwks(){try{let d=this.provider.configuration;v(d,"OpenID Configuration is not initialized."),v(d.jwks_uri,"OpenID Configuration is missing jwks_uri.");let h=d.jwks_uri;return E(h).then(t("Error resolving provider keys")).then(g=>g.json().then(O=>u.importKeys(O)).then(O=>this.provider.jwks=O))}catch(d){return Promise.reject(d)}}createRequest(d,h){return r.create(this,d,h||this.store)}validateResponse(d,h=this.store){let g;d.match(/^http(s?):\/\//)?g={rp:this,redirect:d,session:h}:g={rp:this,body:d,session:h};const O=new e(g);return e.validateResponse(O)}userinfo(){try{let d=this.provider.configuration;v(d,"OpenID Configuration is not initialized."),v(d.userinfo_endpoint,"OpenID Configuration is missing userinfo_endpoint.");let h=d.userinfo_endpoint,g=this.store.access_token;v(g,"Missing access token.");let O=new w({"Content-Type":"application/json",Authorization:`Bearer ${g}`});return E(h,{headers:O}).then(t("Error fetching userinfo")).then(k=>k.json())}catch(d){return Promise.reject(d)}}logoutRequest(d={}){const{id_token_hint:h,post_logout_redirect_uri:g,state:O}=d;let k;if(v(this.provider,"OpenID Configuration is not initialized"),k=this.provider.configuration,v(k,"OpenID Configuration is not initialized"),!k.end_session_endpoint)return console.log(`OpenId Configuration for ${k.issuer} is missing end_session_endpoint`),null;if(g&&!h)throw new Error("id_token_hint is required when using post_logout_redirect_uri");const C={};h&&(C.id_token_hint=h),g&&(C.post_logout_redirect_uri=g),O&&(C.state=O);const B=new S(k.end_session_endpoint);return B.search=s.encode(C),B.href}logout(){let d;try{v(this.provider,"OpenID Configuration is not initialized."),d=this.provider.configuration,v(d,"OpenID Configuration is not initialized."),v(d.end_session_endpoint,"OpenID Configuration is missing end_session_endpoint.")}catch(O){return Promise.reject(O)}if(!d.end_session_endpoint)return this.clearSession(),Promise.resolve(void 0);let h=d.end_session_endpoint;return E(h,{method:"get",credentials:"include"}).then(t("Error logging out")).then(()=>this.clearSession())}clearSession(){let d=this.store;d&&delete d[c]}popTokenFor(d,h){return PoPToken.issueFor(d,h)}}const c="oidc.session.privateKey";l.SESSION_PRIVATE_KEY=c,I.exports=l}).call(this,a(20))},function(I,b){var a;a=function(){return this}();try{a=a||new Function("return this")()}catch{typeof window=="object"&&(a=window)}I.exports=a},function(I,b,a){(function(p){var v=a(22);/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function E(A,R){if(A===R)return 0;for(var N=A.length,x=R.length,z=0,ne=Math.min(N,x);z<ne;++z)if(A[z]!==R[z]){N=A[z],x=R[z];break}return N<x?-1:x<N?1:0}function S(A){return p.Buffer&&typeof p.Buffer.isBuffer=="function"?p.Buffer.isBuffer(A):!!(A!=null&&A._isBuffer)}var w=a(23),f=Object.prototype.hasOwnProperty,u=Array.prototype.slice,r=function(){return(function(){}).name==="foo"}();function e(A){return Object.prototype.toString.call(A)}function i(A){return S(A)||typeof p.ArrayBuffer!="function"?!1:typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(A):A?!!(A instanceof DataView||A.buffer&&A.buffer instanceof ArrayBuffer):!1}var t=I.exports=g,s=/\s*function\s+([^\(\s]*)\s*/;function l(A){if(w.isFunction(A)){if(r)return A.name;var R=A.toString(),N=R.match(s);return N&&N[1]}}t.AssertionError=function(R){this.name="AssertionError",this.actual=R.actual,this.expected=R.expected,this.operator=R.operator,R.message?(this.message=R.message,this.generatedMessage=!1):(this.message=d(this),this.generatedMessage=!0);var N=R.stackStartFunction||h;if(Error.captureStackTrace)Error.captureStackTrace(this,N);else{var x=new Error;if(x.stack){var z=x.stack,ne=l(N),re=z.indexOf(`
`+ne);if(re>=0){var ee=z.indexOf(`
`,re+1);z=z.substring(ee+1)}this.stack=z}}},w.inherits(t.AssertionError,Error);function c(A,R){return typeof A=="string"?A.length<R?A:A.slice(0,R):A}function P(A){if(r||!w.isFunction(A))return w.inspect(A);var R=l(A),N=R?": "+R:"";return"[Function"+N+"]"}function d(A){return c(P(A.actual),128)+" "+A.operator+" "+c(P(A.expected),128)}function h(A,R,N,x,z){throw new t.AssertionError({message:N,actual:A,expected:R,operator:x,stackStartFunction:z})}t.fail=h;function g(A,R){A||h(A,!0,R,"==",t.ok)}t.ok=g,t.equal=function(R,N,x){R!=N&&h(R,N,x,"==",t.equal)},t.notEqual=function(R,N,x){R==N&&h(R,N,x,"!=",t.notEqual)},t.deepEqual=function(R,N,x){O(R,N,!1)||h(R,N,x,"deepEqual",t.deepEqual)},t.deepStrictEqual=function(R,N,x){O(R,N,!0)||h(R,N,x,"deepStrictEqual",t.deepStrictEqual)};function O(A,R,N,x){if(A===R)return!0;if(S(A)&&S(R))return E(A,R)===0;if(w.isDate(A)&&w.isDate(R))return A.getTime()===R.getTime();if(w.isRegExp(A)&&w.isRegExp(R))return A.source===R.source&&A.global===R.global&&A.multiline===R.multiline&&A.lastIndex===R.lastIndex&&A.ignoreCase===R.ignoreCase;if((A===null||typeof A!="object")&&(R===null||typeof R!="object"))return N?A===R:A==R;if(i(A)&&i(R)&&e(A)===e(R)&&!(A instanceof Float32Array||A instanceof Float64Array))return E(new Uint8Array(A.buffer),new Uint8Array(R.buffer))===0;if(S(A)!==S(R))return!1;x=x||{actual:[],expected:[]};var z=x.actual.indexOf(A);return z!==-1&&z===x.expected.indexOf(R)?!0:(x.actual.push(A),x.expected.push(R),C(A,R,N,x))}function k(A){return Object.prototype.toString.call(A)=="[object Arguments]"}function C(A,R,N,x){if(A==null||R===null||R===void 0)return!1;if(w.isPrimitive(A)||w.isPrimitive(R))return A===R;if(N&&Object.getPrototypeOf(A)!==Object.getPrototypeOf(R))return!1;var z=k(A),ne=k(R);if(z&&!ne||!z&&ne)return!1;if(z)return A=u.call(A),R=u.call(R),O(A,R,N);var re=W(A),ee=W(R),se,ie;if(re.length!==ee.length)return!1;for(re.sort(),ee.sort(),ie=re.length-1;ie>=0;ie--)if(re[ie]!==ee[ie])return!1;for(ie=re.length-1;ie>=0;ie--)if(se=re[ie],!O(A[se],R[se],N,x))return!1;return!0}t.notDeepEqual=function(R,N,x){O(R,N,!1)&&h(R,N,x,"notDeepEqual",t.notDeepEqual)},t.notDeepStrictEqual=B;function B(A,R,N){O(A,R,!0)&&h(A,R,N,"notDeepStrictEqual",B)}t.strictEqual=function(R,N,x){R!==N&&h(R,N,x,"===",t.strictEqual)},t.notStrictEqual=function(R,N,x){R===N&&h(R,N,x,"!==",t.notStrictEqual)};function J(A,R){if(!A||!R)return!1;if(Object.prototype.toString.call(R)=="[object RegExp]")return R.test(A);try{if(A instanceof R)return!0}catch{}return Error.isPrototypeOf(R)?!1:R.call({},A)===!0}function $(A){var R;try{A()}catch(N){R=N}return R}function q(A,R,N,x){var z;if(typeof R!="function")throw new TypeError('"block" argument must be a function');typeof N=="string"&&(x=N,N=null),z=$(R),x=(N&&N.name?" ("+N.name+").":".")+(x?" "+x:"."),A&&!z&&h(z,N,"Missing expected exception"+x);var ne=typeof x=="string",re=!A&&w.isError(z),ee=!A&&z&&!N;if((re&&ne&&J(z,N)||ee)&&h(z,N,"Got unwanted exception"+x),A&&z&&N&&!J(z,N)||!A&&z)throw z}t.throws=function(A,R,N){q(!0,A,R,N)},t.doesNotThrow=function(A,R,N){q(!1,A,R,N)},t.ifError=function(A){if(A)throw A};function K(A,R){A||h(A,!0,R,"==",K)}t.strict=v(K,t,{equal:t.strictEqual,deepEqual:t.deepStrictEqual,notEqual:t.notStrictEqual,notDeepEqual:t.notDeepStrictEqual}),t.strict.strict=t.strict;var W=Object.keys||function(A){var R=[];for(var N in A)f.call(A,N)&&R.push(N);return R}}).call(this,a(20))},function(I,b,a){/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var p=Object.getOwnPropertySymbols,v=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;function S(f){if(f==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(f)}function w(){try{if(!Object.assign)return!1;var f=new String("abc");if(f[5]="de",Object.getOwnPropertyNames(f)[0]==="5")return!1;for(var u={},r=0;r<10;r++)u["_"+String.fromCharCode(r)]=r;var e=Object.getOwnPropertyNames(u).map(function(t){return u[t]});if(e.join("")!=="0123456789")return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(t){i[t]=t}),Object.keys(Object.assign({},i)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}I.exports=w()?Object.assign:function(f,u){for(var r,e=S(f),i,t=1;t<arguments.length;t++){r=Object(arguments[t]);for(var s in r)v.call(r,s)&&(e[s]=r[s]);if(p){i=p(r);for(var l=0;l<i.length;l++)E.call(r,i[l])&&(e[i[l]]=r[i[l]])}}return e}},function(I,b,a){(function(p){var v=Object.getOwnPropertyDescriptors||function(D){for(var L=Object.keys(D),H={},G=0;G<L.length;G++)H[L[G]]=Object.getOwnPropertyDescriptor(D,L[G]);return H},E=/%[sdj%]/g;b.format=function(j){if(!C(j)){for(var D=[],L=0;L<arguments.length;L++)D.push(f(arguments[L]));return D.join(" ")}for(var L=1,H=arguments,G=H.length,X=String(j).replace(E,function(V){if(V==="%%")return"%";if(L>=G)return V;switch(V){case"%s":return String(H[L++]);case"%d":return Number(H[L++]);case"%j":try{return JSON.stringify(H[L++])}catch{return"[Circular]"}default:return V}}),F=H[L];L<G;F=H[++L])g(F)||!q(F)?X+=" "+F:X+=" "+f(F);return X},b.deprecate=function(j,D){if(typeof p<"u"&&p.noDeprecation===!0)return j;if(typeof p>"u")return function(){return b.deprecate(j,D).apply(this,arguments)};var L=!1;function H(){if(!L){if(p.throwDeprecation)throw new Error(D);p.traceDeprecation?console.trace(D):console.error(D),L=!0}return j.apply(this,arguments)}return H};var S={},w;b.debuglog=function(j){if(J(w)&&(w=p.env.NODE_DEBUG||""),j=j.toUpperCase(),!S[j])if(new RegExp("\\b"+j+"\\b","i").test(w)){var D=p.pid;S[j]=function(){var L=b.format.apply(b,arguments);console.error("%s %d: %s",j,D,L)}}else S[j]=function(){};return S[j]};function f(j,D){var L={seen:[],stylize:r};return arguments.length>=3&&(L.depth=arguments[2]),arguments.length>=4&&(L.colors=arguments[3]),h(D)?L.showHidden=D:D&&b._extend(L,D),J(L.showHidden)&&(L.showHidden=!1),J(L.depth)&&(L.depth=2),J(L.colors)&&(L.colors=!1),J(L.customInspect)&&(L.customInspect=!0),L.colors&&(L.stylize=u),i(L,j,L.depth)}b.inspect=f,f.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},f.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function u(j,D){var L=f.styles[D];return L?"\x1B["+f.colors[L][0]+"m"+j+"\x1B["+f.colors[L][1]+"m":j}function r(j,D){return j}function e(j){var D={};return j.forEach(function(L,H){D[L]=!0}),D}function i(j,D,L){if(j.customInspect&&D&&A(D.inspect)&&D.inspect!==b.inspect&&!(D.constructor&&D.constructor.prototype===D)){var H=D.inspect(L,j);return C(H)||(H=i(j,H,L)),H}var G=t(j,D);if(G)return G;var X=Object.keys(D),F=e(X);if(j.showHidden&&(X=Object.getOwnPropertyNames(D)),W(D)&&(X.indexOf("message")>=0||X.indexOf("description")>=0))return s(D);if(X.length===0){if(A(D)){var V=D.name?": "+D.name:"";return j.stylize("[Function"+V+"]","special")}if($(D))return j.stylize(RegExp.prototype.toString.call(D),"regexp");if(K(D))return j.stylize(Date.prototype.toString.call(D),"date");if(W(D))return s(D)}var Z="",ae=!1,ue=["{","}"];if(d(D)&&(ae=!0,ue=["[","]"]),A(D)){var fe=D.name?": "+D.name:"";Z=" [Function"+fe+"]"}if($(D)&&(Z=" "+RegExp.prototype.toString.call(D)),K(D)&&(Z=" "+Date.prototype.toUTCString.call(D)),W(D)&&(Z=" "+s(D)),X.length===0&&(!ae||D.length==0))return ue[0]+Z+ue[1];if(L<0)return $(D)?j.stylize(RegExp.prototype.toString.call(D),"regexp"):j.stylize("[Object]","special");j.seen.push(D);var le;return ae?le=l(j,D,L,F,X):le=X.map(function(de){return c(j,D,L,F,de,ae)}),j.seen.pop(),P(le,Z,ue)}function t(j,D){if(J(D))return j.stylize("undefined","undefined");if(C(D)){var L="'"+JSON.stringify(D).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return j.stylize(L,"string")}if(k(D))return j.stylize(""+D,"number");if(h(D))return j.stylize(""+D,"boolean");if(g(D))return j.stylize("null","null")}function s(j){return"["+Error.prototype.toString.call(j)+"]"}function l(j,D,L,H,G){for(var X=[],F=0,V=D.length;F<V;++F)re(D,String(F))?X.push(c(j,D,L,H,String(F),!0)):X.push("");return G.forEach(function(Z){Z.match(/^\d+$/)||X.push(c(j,D,L,H,Z,!0))}),X}function c(j,D,L,H,G,X){var F,V,Z;if(Z=Object.getOwnPropertyDescriptor(D,G)||{value:D[G]},Z.get?Z.set?V=j.stylize("[Getter/Setter]","special"):V=j.stylize("[Getter]","special"):Z.set&&(V=j.stylize("[Setter]","special")),re(H,G)||(F="["+G+"]"),V||(j.seen.indexOf(Z.value)<0?(g(L)?V=i(j,Z.value,null):V=i(j,Z.value,L-1),V.indexOf(`
`)>-1&&(X?V=V.split(`
`).map(function(ae){return"  "+ae}).join(`
`).substr(2):V=`
`+V.split(`
`).map(function(ae){return"   "+ae}).join(`
`))):V=j.stylize("[Circular]","special")),J(F)){if(X&&G.match(/^\d+$/))return V;F=JSON.stringify(""+G),F.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(F=F.substr(1,F.length-2),F=j.stylize(F,"name")):(F=F.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),F=j.stylize(F,"string"))}return F+": "+V}function P(j,D,L){var H=j.reduce(function(G,X){return X.indexOf(`
`)>=0,G+X.replace(/\u001b\[\d\d?m/g,"").length+1},0);return H>60?L[0]+(D===""?"":D+`
 `)+" "+j.join(`,
  `)+" "+L[1]:L[0]+D+" "+j.join(", ")+" "+L[1]}function d(j){return Array.isArray(j)}b.isArray=d;function h(j){return typeof j=="boolean"}b.isBoolean=h;function g(j){return j===null}b.isNull=g;function O(j){return j==null}b.isNullOrUndefined=O;function k(j){return typeof j=="number"}b.isNumber=k;function C(j){return typeof j=="string"}b.isString=C;function B(j){return typeof j=="symbol"}b.isSymbol=B;function J(j){return j===void 0}b.isUndefined=J;function $(j){return q(j)&&N(j)==="[object RegExp]"}b.isRegExp=$;function q(j){return typeof j=="object"&&j!==null}b.isObject=q;function K(j){return q(j)&&N(j)==="[object Date]"}b.isDate=K;function W(j){return q(j)&&(N(j)==="[object Error]"||j instanceof Error)}b.isError=W;function A(j){return typeof j=="function"}b.isFunction=A;function R(j){return j===null||typeof j=="boolean"||typeof j=="number"||typeof j=="string"||typeof j=="symbol"||typeof j>"u"}b.isPrimitive=R,b.isBuffer=a(25);function N(j){return Object.prototype.toString.call(j)}function x(j){return j<10?"0"+j.toString(10):j.toString(10)}var z=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function ne(){var j=new Date,D=[x(j.getHours()),x(j.getMinutes()),x(j.getSeconds())].join(":");return[j.getDate(),z[j.getMonth()],D].join(" ")}b.log=function(){console.log("%s - %s",ne(),b.format.apply(b,arguments))},b.inherits=a(26),b._extend=function(j,D){if(!D||!q(D))return j;for(var L=Object.keys(D),H=L.length;H--;)j[L[H]]=D[L[H]];return j};function re(j,D){return Object.prototype.hasOwnProperty.call(j,D)}var ee=typeof Symbol<"u"?Symbol("util.promisify.custom"):void 0;b.promisify=function(D){if(typeof D!="function")throw new TypeError('The "original" argument must be of type Function');if(ee&&D[ee]){var L=D[ee];if(typeof L!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(L,ee,{value:L,enumerable:!1,writable:!1,configurable:!0}),L}function L(){for(var H,G,X=new Promise(function(Z,ae){H=Z,G=ae}),F=[],V=0;V<arguments.length;V++)F.push(arguments[V]);F.push(function(Z,ae){Z?G(Z):H(ae)});try{D.apply(this,F)}catch(Z){G(Z)}return X}return Object.setPrototypeOf(L,Object.getPrototypeOf(D)),ee&&Object.defineProperty(L,ee,{value:L,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(L,v(D))},b.promisify.custom=ee;function se(j,D){if(!j){var L=new Error("Promise was rejected with a falsy value");L.reason=j,j=L}return D(j)}function ie(j){if(typeof j!="function")throw new TypeError('The "original" argument must be of type Function');function D(){for(var L=[],H=0;H<arguments.length;H++)L.push(arguments[H]);var G=L.pop();if(typeof G!="function")throw new TypeError("The last argument must be of type Function");var X=this,F=function(){return G.apply(X,arguments)};j.apply(this,L).then(function(V){p.nextTick(F,null,V)},function(V){p.nextTick(se,V,F)})}return Object.setPrototypeOf(D,Object.getPrototypeOf(j)),Object.defineProperties(D,v(j)),D}b.callbackify=ie}).call(this,a(24))},function(I,b){var a=I.exports={},p,v;function E(){throw new Error("setTimeout has not been defined")}function S(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?p=setTimeout:p=E}catch{p=E}try{typeof clearTimeout=="function"?v=clearTimeout:v=S}catch{v=S}})();function w(P){if(p===setTimeout)return setTimeout(P,0);if((p===E||!p)&&setTimeout)return p=setTimeout,setTimeout(P,0);try{return p(P,0)}catch{try{return p.call(null,P,0)}catch{return p.call(this,P,0)}}}function f(P){if(v===clearTimeout)return clearTimeout(P);if((v===S||!v)&&clearTimeout)return v=clearTimeout,clearTimeout(P);try{return v(P)}catch{try{return v.call(null,P)}catch{return v.call(this,P)}}}var u=[],r=!1,e,i=-1;function t(){!r||!e||(r=!1,e.length?u=e.concat(u):i=-1,u.length&&s())}function s(){if(!r){var P=w(t);r=!0;for(var d=u.length;d;){for(e=u,u=[];++i<d;)e&&e[i].run();i=-1,d=u.length}e=null,r=!1,f(P)}}a.nextTick=function(P){var d=new Array(arguments.length-1);if(arguments.length>1)for(var h=1;h<arguments.length;h++)d[h-1]=arguments[h];u.push(new l(P,d)),u.length===1&&!r&&w(s)};function l(P,d){this.fun=P,this.array=d}l.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={};function c(){}a.on=c,a.addListener=c,a.once=c,a.off=c,a.removeListener=c,a.removeAllListeners=c,a.emit=c,a.prependListener=c,a.prependOnceListener=c,a.listeners=function(P){return[]},a.binding=function(P){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(P){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(I,b){I.exports=function(p){return p&&typeof p=="object"&&typeof p.copy=="function"&&typeof p.fill=="function"&&typeof p.readUInt8=="function"}},function(I,b){typeof Object.create=="function"?I.exports=function(p,v){p.super_=v,p.prototype=Object.create(v.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}})}:I.exports=function(p,v){p.super_=v;var E=function(){};E.prototype=v.prototype,p.prototype=new E,p.prototype.constructor=p}},function(I,b){(function(){I.exports=window.window})()},function(I,b,a){I.exports={Formats:a(29),Initializer:a(30),JSONDocument:a(31),JSONMapping:a(34),JSONPatch:a(32),JSONPointer:a(33),JSONSchema:a(35),Validator:a(36)}},function(I,b,a){var p=function(){function i(t,s){for(var l=0;l<s.length;l++){var c=s[l];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,c.key,c)}}return function(t,s,l){return s&&i(t.prototype,s),l&&i(t,l),t}}();function v(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var E=/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s][0-2]\d:[0-5]\d:[0-5]\d(?:\.\d+)?(?:z|[+-]\d\d:\d\d)$/i,S=/^(?:[a-z][a-z0-9+-.]*)?(?:\:|\/)\/?[^\s]*$/i,w=/^[a-z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,f=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,u=/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,r=/^[a-z](?:(?:[-0-9a-z]{0,61})?[0-9a-z])?(\.[a-z](?:(?:[-0-9a-z]{0,61})?[0-9a-z])?)*$/i,e=function(){function i(){v(this,i)}return p(i,[{key:"register",value:function(s,l){if(typeof s!="string")throw new Error("Format name must be a string");return typeof l=="string"&&(l=new RegExp(l)),this[s]=l}},{key:"resolve",value:function(s){var l=this[s];if(!l)throw new Error("Unknown JSON Schema format.");return l}},{key:"test",value:function(s,l){var c=this.resolve(s);return c.test(l)}}],[{key:"initialize",value:function(){var s=new i;return s.register("date-time",E),s.register("uri",S),s.register("email",w),s.register("ipv4",f),s.register("ipv6",u),s.register("hostname",r),s}}]),i}();I.exports=e.initialize()},function(I,b,a){var p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(w){return typeof w}:function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w},v=function(){function w(f,u){for(var r=0;r<u.length;r++){var e=u[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(f,e.key,e)}}return function(f,u,r){return u&&w(f.prototype,u),r&&w(f,r),f}}();function E(w,f){if(!(w instanceof f))throw new TypeError("Cannot call a class as a function")}var S=function(){function w(f,u){E(this,w),Object.assign(this,u||{}),this.root=this.root||this,this.root.depth=this.root.depth||1,this.level>this.root.depth&&(this.root.depth=this.level),this.level=this.level||0,this.schema=f}return v(w,[{key:"compile",value:function(){var u=this.root;this.depth,this.level;var r="",e="";if(e+=this.default(),e+=this.properties(),e+=this.items(),e+=this.member(),e+=this.item(),u===this){for(var i=1;i<=this.root.depth;i++)r+=this.declaration(i);return`
        options = options || {}

        if (options.filter === false) {
          Object.assign(target, JSON.parse(JSON.stringify(source)))
        }

        `+r+`
        `+e+`
      `}return e}},{key:"declaration",value:function(u){return`
      var target`+u+`
      var source`+u+`
      var count`+u+`
    `}},{key:"default",value:function(){var u=this.schema,r=this.level,e=this.key,i=this.index,t=u.default,s="";return u.hasOwnProperty("default")&&(e&&(s+=`
          target`+r+"['"+e+"'] = "+JSON.stringify(t)+`
        `),i&&(s+=`
          target`+r+"["+i+"] = "+JSON.stringify(t)+`
        `),r>1&&(s+=`
          count`+r+`++
        `),s=`
        if (options.defaults !== false) {
          `+s+`
        }
      `),s}},{key:"member",value:function(){var u=this.schema;this.root;var r=this.level,e=this.key,i=u.properties,t=u.additionalProperties,s=u.items,l=u.additionalItems,c="";return e&&!i&&!t&&!s&&!l&&(c+=`
        target`+r+"['"+e+"'] = source"+r+"['"+e+`']
      `,r>1&&(c+=`
          count`+r+`++
        `),c=`
        if (source`+r+".hasOwnProperty('"+e+`')) {
          `+c+`
        }
      `),c}},{key:"item",value:function(){var u=this.schema;this.root;var r=this.level,e=this.index,i=u.properties,t=u.additionalProperties,s=u.items,l=u.additionalItems,c="";return e&&!i&&!t&&!s&&!l&&(c+=`
        target`+r+"["+e+"] = source"+r+"["+e+`]
      `,r>1&&(c+=`
          count`+r+`++
        `),c=`
        if (`+e+` < len) {
          `+c+`
        }
      `),c}},{key:"properties",value:function(){var u=this.schema,r=this.root,e=this.level,i=this.key,t=this.index,s=u.properties,l="";return s&&(Object.keys(s).forEach(function(c){var P=s[c],d=new w(P,{key:c,root:r,level:e+1});l+=d.compile()}),r===this?l=`
          if (typeof source === 'object' && source !== null && !Array.isArray(source)) {
            if (typeof target !== 'object') {
              throw new Error('?')
            }

            source1 = source
            target1 = target
            count1 = 0

            `+l+`
          }
        `:(t&&(l=`
            if (`+t+" < source"+e+".length || typeof source"+e+"["+t+`] === 'object') {

              source`+(e+1)+" = source"+e+"["+t+`] || {}
              count`+(e+1)+` = 0

              if (`+t+" < target"+e+".length || typeof target"+e+"["+t+`] !== 'object') {
                target`+(e+1)+` = {}
                if (`+t+" < source"+e+`.length) {
                  count`+(e+1)+`++
                }
              } else {
                target`+(e+1)+" = target"+e+"["+t+`]
              }

              `+l+`

              if (count`+(e+1)+` > 0) {
                target`+e+"["+t+"] = target"+(e+1)+`
                count`+e+`++
              }

            } else {
              target`+e+"["+t+"] = source"+e+"["+t+`]
              count`+e+`++
            }
          `),i&&(l=`
            if ((typeof source`+e+"['"+i+`'] === 'object'
                  && source`+e+"['"+i+`'] !== null
                  && !Array.isArray(source`+e+"['"+i+`']))
                || !source`+e+".hasOwnProperty('"+i+`')) {

              source`+(e+1)+" = source"+e+"['"+i+`'] || {}
              count`+(e+1)+` = 0

              if (!target`+e+".hasOwnProperty('"+i+`')
                  || typeof target`+e+"['"+i+`'] !== 'object'
                  || target`+e+"['"+i+`'] === null
                  || Array.isArray(target`+e+"['"+i+`'])) {
                target`+(e+1)+` = {}
                if (source`+e+".hasOwnProperty('"+i+`')) {
                  count`+(e+1)+`++
                }
              } else {
                target`+(e+1)+" = target"+e+"['"+i+`']
                count`+(e+1)+`++
              }

              `+l+`

              if (count`+(e+1)+` > 0) {
                target`+e+"['"+i+"'] = target"+(e+1)+`
                count`+e+`++
              }

            } else {
              target`+e+"['"+i+"'] = source"+e+"['"+i+`']
              count`+e+`++
            }
          `))),l}},{key:"additionalProperties",value:function(){}},{key:"items",value:function(){var u=this.schema,r=this.root,e=this.level,i=this.key;this.index;var t=u.items,s="";if(t){if(!Array.isArray(t)){if((typeof t>"u"?"undefined":p(t))==="object"&&t!==null){var l="i"+(e+1),c=new w(t,{index:l,root:r,level:e+1});s+=`
          var sLen = source`+(e+1)+`.length || 0
          var tLen = target`+(e+1)+`.length || 0
          var len = 0

          if (sLen > len) { len = sLen }
          // THIS IS WRONG, CAUSED SIMPLE ARRAY INIT TO FAIL (OVERWRITE
          // EXISTING TARGET VALUES WITH UNDEFINED WHEN SOURCE IS SHORTER THAN
          // TARGET). LEAVING HERE UNTIL WE FINISH TESTING AND SEE WHY IT MIGHT
          // HAVE BEEN HERE IN THE FIRST PLACE.
          //
          // if (tLen > len) { len = tLen }

          for (var `+l+" = 0; "+l+" < len; "+l+`++) {
            `+c.compile()+`
          }
        `}}r===this?s=`
          if (Array.isArray(source)) {
            if (!Array.isArray(target)) {
              throw new Error('?')
            }

            source1 = source
            target1 = target

            `+s+`
          }
        `:s=`
          if (Array.isArray(source`+e+"['"+i+"']) || !source"+e+".hasOwnProperty('"+i+`')) {

            source`+(e+1)+" = source"+e+"['"+i+`'] || []
            count`+(e+1)+` = 0

            if (!target`+e+".hasOwnProperty('"+i+"') || !Array.isArray(target"+e+"['"+i+`'])) {
              target`+(e+1)+` = []
                if (source`+e+".hasOwnProperty('"+i+`')) {
                  count`+(e+1)+`++
                }

            } else {
              target`+(e+1)+" = target"+e+"['"+i+`']
              count`+(e+1)+`++
            }

            `+s+`

            if (count`+(e+1)+` > 0) {
              target`+e+"['"+i+"'] = target"+(e+1)+`
              count`+e+`++
            }

          } else {
            target`+e+"['"+i+"'] = source"+e+"['"+i+`']
            count`+e+`++
          }
        `}return s}},{key:"additionalItems",value:function(){}}],[{key:"compile",value:function(u){var r=new w(u),e=r.compile();try{return new Function("target","source","options",e)}catch(i){console.log(i,i.stack)}}}]),w}();I.exports=S},function(I,b,a){var p=function(){function w(f,u){for(var r=0;r<u.length;r++){var e=u[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(f,e.key,e)}}return function(f,u,r){return u&&w(f.prototype,u),r&&w(f,r),f}}();function v(w,f){if(!(w instanceof f))throw new TypeError("Cannot call a class as a function")}var E=a(32),S=function(){p(w,null,[{key:"schema",get:function(){throw new Error("Schema must be defined by classes extending JSONDocument")}}]);function w(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};v(this,w),this.initialize(f,u)}return p(w,[{key:"initialize",value:function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=this.constructor.schema;e.initialize(this,u,r)}},{key:"validate",value:function(u){var r=this.constructor.schema;return(u||r).validate(this)}},{key:"patch",value:function(u){var r=new E(u);r.apply(this)}},{key:"select",value:function(){}},{key:"project",value:function(u){return u.project(this)}}],[{key:"serialize",value:function(u){return JSON.stringify(u)}},{key:"deserialize",value:function(u){try{return JSON.parse(u)}catch{throw new Error("Failed to parse JSON")}}}]),w}();I.exports=S},function(I,b,a){var p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},v=function(){function r(e,i){for(var t=0;t<i.length;t++){var s=i[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,i,t){return i&&r(e.prototype,i),t&&r(e,t),e}}();function E(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}var S=a(33),w=2,f=["add","remove","replace","move","copy","test"],u=function(){function r(e){E(this,r),this.ops=e||[]}return v(r,[{key:"apply",value:function(i){var t=this;this.ops.forEach(function(s){var l=s.op;if(!l)throw new Error('Missing "op" in JSON Patch operation');if(f.indexOf(l)===-1)throw new Error('Invalid "op" in JSON Patch operation');if(!s.path)throw new Error('Missing "path" in JSON Patch operation');t[l](s,i)})}},{key:"add",value:function(i,t){if(i.value===void 0)throw new Error('Missing "value" in JSON Patch add operation');var s=new S(i.path,w);s.add(t,i.value)}},{key:"remove",value:function(i,t){var s=new S(i.path);s.remove(t)}},{key:"replace",value:function(i,t){if(i.value===void 0)throw new Error('Missing "value" in JSON Patch replace operation');var s=new S(i.path);s.replace(t,i.value)}},{key:"move",value:function(i,t){if(i.from===void 0)throw new Error('Missing "from" in JSON Patch move operation');if(i.path.match(new RegExp("^"+i.from)))throw new Error('Invalid "from" in JSON Patch move operation');var s=new S(i.path),l=new S(i.from),c=l.get(t);l.remove(t),s.add(t,c)}},{key:"copy",value:function(i,t){if(i.from===void 0)throw new Error('Missing "from" in JSON Patch copy operation');var s=new S(i.path),l=new S(i.from),c=l.get(t);s.add(t,c)}},{key:"test",value:function(i,t){if(i.value===void 0)throw new Error('Missing "value" in JSON Patch test operation');var s=new S(i.path),l=s.get(t);switch(p(i.value)){default:if(l!==i.value)throw new Error("Mismatching JSON Patch test value")}}}]),r}();I.exports=u},function(I,b,a){var p=function(){function u(r,e){for(var i=0;i<e.length;i++){var t=e[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}return function(r,e,i){return e&&u(r.prototype,e),i&&u(r,i),r}}();function v(u,r){if(!(u instanceof r))throw new TypeError("Cannot call a class as a function")}var E=0,S=1,w=2,f=function(){function u(r,e){v(this,u),this.expr=r,this.mode=e||E,this.tokens=r&&r.charAt(0)==="#"?this.parseURIFragmentIdentifier(r):this.parseJSONString(r)}return p(u,[{key:"escape",value:function(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}},{key:"unescape",value:function(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}},{key:"parseJSONString",value:function(e){if(typeof e!="string")throw new Error("JSON Pointer must be a string");if(e==="")return[];if(e.charAt(0)!=="/")throw new Error("Invalid JSON Pointer");return e==="/"?[""]:e.substr(1).split("/").map(this.unescape)}},{key:"toJSONString",value:function(){return"/"+this.tokens.map(this.escape).join("/")}},{key:"parseURIFragmentIdentifier",value:function(e){if(typeof e!="string")throw new Error("JSON Pointer must be a string");if(e.charAt(0)!=="#")throw new Error("Invalid JSON Pointer URI Fragment Identifier");return this.parseJSONString(decodeURIComponent(e.substr(1)))}},{key:"toURIFragmentIdentifier",value:function(){var e=this,i=this.tokens.map(function(t){return encodeURIComponent(e.escape(t))}).join("/");return"#/"+i}},{key:"get",value:function(e){for(var i=e,t=this.tokens,s=0;s<t.length;s++){if(!i||i[t[s]]===void 0){if(this.mode!==E)return;throw new Error("Invalid JSON Pointer reference")}i=i[t[s]]}return i}},{key:"add",value:function(e,i){for(var t=this.tokens,s=e,l=0;l<t.length;l++){var c=t[l];if(l===t.length-1)c==="-"?s.push(i):Array.isArray(s)?s.splice(c,0,i):i!==void 0&&(s[c]=i);else if(s[c])s=s[c];else switch(this.mode){case E:throw new Error("Invalid JSON Pointer reference");case S:s=s[c]=parseInt(c)?[]:{};break;case w:return;default:throw new Error("Invalid pointer mode")}}}},{key:"replace",value:function(e,i){for(var t=this.tokens,s=e,l=0;l<t.length;l++){var c=t[l];l===t.length-1?s[c]=i:s[c]?s=s[c]:s=s[c]=parseInt(c)?[]:{}}}},{key:"remove",value:function(e){for(var i=this.tokens,t=e,s=0;s<i.length;s++){var l=i[s];if(t===void 0||t[l]===void 0)return;if(Array.isArray(t)){t.splice(l,1);return}else s===i.length-1&&delete t[l];t=t[l]}}}],[{key:"parse",value:function(e){return new u(e)}}]),u}();I.exports=f},function(I,b,a){var p=function(){function f(u,r){for(var e=0;e<r.length;e++){var i=r[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(u,i.key,i)}}return function(u,r,e){return r&&f(u.prototype,r),e&&f(u,e),u}}();function v(f,u){if(!(f instanceof u))throw new TypeError("Cannot call a class as a function")}var E=a(33),S=1,w=function(){function f(u){var r=this;v(this,f),Object.defineProperty(this,"mapping",{enumerable:!1,value:new Map}),Object.keys(u).forEach(function(e){var i=u[e];r.mapping.set(new E(e,S),new E(i,S))})}return p(f,[{key:"map",value:function(r,e){this.mapping.forEach(function(i,t){t.add(r,i.get(e))})}},{key:"project",value:function(r,e){this.mapping.forEach(function(i,t){i.add(e,t.get(r))})}}]),f}();I.exports=w},function(I,b,a){var p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},v=function(){function r(e,i){for(var t=0;t<i.length;t++){var s=i[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,i,t){return i&&r(e.prototype,i),t&&r(e,t),e}}();function E(r,e,i){return e in r?Object.defineProperty(r,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[e]=i,r}function S(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}var w=a(30),f=a(36),u=function(){function r(e){S(this,r),Object.assign(this,e),Object.defineProperties(this,{initialize:{enumerable:!1,writeable:!1,value:w.compile(e)},validate:{enumerable:!1,writeable:!1,value:f.compile(e)}})}return v(r,[{key:"extend",value:function(i){function t(c){return c&&(typeof c>"u"?"undefined":p(c))==="object"&&c!==null&&!Array.isArray(c)}function s(c,P){var d=Object.assign({},c);return t(c)&&t(P)&&Object.keys(P).forEach(function(h){t(P[h])?h in c?d[h]=s(c[h],P[h]):Object.assign(d,E({},h,P[h])):Object.assign(d,E({},h,P[h]))}),d}var l=s(this,i);return new r(l)}}]),r}();I.exports=u},function(I,b,a){var p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},v=function(){function u(r,e){for(var i=0;i<e.length;i++){var t=e[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}return function(r,e,i){return e&&u(r.prototype,e),i&&u(r,i),r}}();function E(u,r){if(!(u instanceof r))throw new TypeError("Cannot call a class as a function")}var S=a(29),w=0,f=function(){v(u,null,[{key:"compile",value:function(e){var i=new u(e),t=`
      // "cursor"
      let value = data
      let container
      let stack = []
      let top = -1

      // error state
      let valid = true
      let errors = []

      // complex schema state
      let initialValidity
      let anyValid
      let notValid
      let countOfValid
      let initialErrorCount
      let accumulatedErrorCount

      // validation code
      `+i.compile()+`

      // validation result
      return {
        valid,
        errors
      }
    `;return new Function("data",t)}},{key:"counter",get:function(){return w++}}]);function u(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};E(this,u),this.schema=r,Object.assign(this,e),this.address||(this.address=""),this.require!==!0&&(this.require=!1)}return v(u,[{key:"compile",value:function(){var e="";return this.require&&(e+=this.required()),e+=this.type(),e+=this.array(),e+=this.number(),e+=this.object(),e+=this.string(),e+=this.enum(),e+=this.anyOf(),e+=this.allOf(),e+=this.not(),e+=this.oneOf(),e}},{key:"push",value:function(){return`
      stack.push(value)
      container = value
      top++
    `}},{key:"pop",value:function(){return`
      if (stack.length > 1) {
        top--
        stack.pop()
      }

      value = container = stack[top]
    `}},{key:"type",value:function(){var e=this.schema.type,i=this.address,t="";if(e){var s=Array.isArray(e)?e:[e],l=s.map(function(c){if(c==="array")return"!Array.isArray(value)";if(c==="boolean")return"typeof value !== 'boolean'";if(c==="integer")return"!Number.isInteger(value)";if(c==="null")return"value !== null";if(c==="number")return"typeof value !== 'number'";if(c==="object")return"(typeof value !== 'object' || Array.isArray(value) || value === null)";if(c==="string")return"typeof value !== 'string'"}).join(" && ");t+=`
      // `+i+` type checking
      if (value !== undefined && `+l+`) {
        valid = false
        errors.push({
          keyword: 'type',
          message: 'invalid type'
        })
      }
      `}return t}},{key:"array",value:function(){var e=["additionalItems","items","minItems","maxItems","uniqueItems"],i=this.validations(e),t="";return i.length>0&&(t+=`
      /**
       * Array validations
       */
      if (Array.isArray(value)) {
      `+i+`
      }
      `),t}},{key:"number",value:function(){var e=["minimum","maximum","multipleOf"],i=this.validations(e),t="";return i.length>0&&(t+=`
      /**
       * Number validations
       */
      if (typeof value === 'number') {
      `+i+`
      }
      `),t}},{key:"object",value:function(){var e=["maxProperties","minProperties","additionalProperties","properties","patternProperties","dependencies","schemaDependencies","propertyDependencies"],i=this.validations(e),t="";return i.length>0&&(t+=`
      /**
       * Object validations
       */
      if (typeof value === 'object' && value !== null && !Array.isArray(value)) {
      `+i+`
      }
      `),t}},{key:"string",value:function(){var e=["maxLength","minLength","pattern","format"],i=this.validations(e),t="";return i.length>0&&(t+=`
      /**
       * String validations
       */
      if (typeof value === 'string') {
      `+i+`
      }
      `),t}},{key:"validations",value:function(e){var i=this,t=this.schema,s="",l=Object.keys(t).filter(function(c){return e.indexOf(c)!==-1});return l.forEach(function(c){s+=i[c]()}),s}},{key:"enum",value:function(){var e=this.schema.enum,i=this.address,t=["value !== undefined"],s="";return e&&(e.forEach(function(l){switch(typeof l>"u"?"undefined":p(l)){case"boolean":t.push("value !== "+l);break;case"number":t.push("value !== "+l);break;case"string":t.push('value !== "'+l+'"');break;case"object":l===null?t.push("value !== null"):t.push("'"+JSON.stringify(l)+"' !== JSON.stringify(value)");break;default:throw new Error("Things are not well in the land of enum")}}),s+=`
      /**
       * Validate "`+i+`" enum
       */
      if (`+t.join(" && ")+`) {
        valid = false
        errors.push({
          keyword: 'enum',
          message: JSON.stringify(value) + ' is not an enumerated value'
        })
      }
      `),s}},{key:"anyOf",value:function(){var e=this.schema.anyOf,i=this.address,t="";return Array.isArray(e)&&(t+=`
        initialValidity = valid
        initialErrorCount = errors.length
        anyValid = false
      `,e.forEach(function(s){var l=new u(s,{address:i});t+=`
        accumulatedErrorCount = errors.length
        `+l.compile()+`
        if (accumulatedErrorCount === errors.length) {
          anyValid = true
        }
        `}),t+=`
          if (anyValid === true) {
            valid = initialValidity
            errors = errors.slice(0, initialErrorCount)
          }
      `),t}},{key:"allOf",value:function(){var e=this.schema.allOf,i=this.address,t="";return Array.isArray(e)&&e.forEach(function(s){var l=new u(s,{address:i});t+=`
        `+l.compile()+`
        `}),t}},{key:"oneOf",value:function(){var e=this.schema.oneOf,i=this.address,t="";return Array.isArray(e)&&(t+=`
        /**
         * Validate `+i+` oneOf
         */
        initialValidity = valid
        initialErrorCount = errors.length
        countOfValid = 0
      `,e.forEach(function(s){var l=new u(s,{address:i});t+=`
        accumulatedErrorCount = errors.length
        `+l.compile()+`
        if (accumulatedErrorCount === errors.length) {
          countOfValid += 1
        }
        `}),t+=`
          if (countOfValid === 1) {
            valid = initialValidity
            errors = errors.slice(0, initialErrorCount)
          } else {
            valid = false
            errors.push({
              keyword: 'oneOf',
              message: 'what is a reasonable error message for this case?'
            })
          }
      `),t}},{key:"not",value:function(){var e=this.schema.not,i=this.address,t="";if((typeof e>"u"?"undefined":p(e))==="object"&&e!==null&&!Array.isArray(e)){var s=e,l=new u(s,{address:i});t+=`
        /**
         * NOT
         */
        if (value !== undefined) {
          initialValidity = valid
          initialErrorCount = errors.length
          notValid = true

          accumulatedErrorCount = errors.length

          `+l.compile()+`

          if (accumulatedErrorCount === errors.length) {
            notValid = false
          }

          if (notValid === true) {
            valid = initialValidity
            errors = errors.slice(0, initialErrorCount)
          } else {
            valid = false
            errors = errors.slice(0, initialErrorCount)
            errors.push({
              keyword: 'not',
              message: 'hmm...'
            })
          }
        }
      `}return t}},{key:"properties",value:function(){var e=this.schema,i=this.address,t=e.properties,s=e.required,l=this.push();return s=Array.isArray(s)?s:[],(typeof t>"u"?"undefined":p(t))==="object"&&Object.keys(t).forEach(function(c){var P=t[c],d=s.indexOf(c)!==-1,h=[i,c].filter(function(O){return!!O}).join("."),g=new u(P,{address:h,require:d});l+=`
        value = container['`+c+`']
        `,l+=g.compile()}),l+=this.pop(),l}},{key:"otherProperties",value:function(){return`
      /**
       * Validate Other Properties
       */
      `+this.push()+`

      for (let key in container) {
        value = container[key]
        matched = false

        `+this.patternValidations()+`
        `+this.additionalValidations()+`
      }

      `+this.pop()+`
    `}},{key:"patternValidations",value:function(){var e=this.schema.patternProperties,i="";return(typeof e>"u"?"undefined":p(e))==="object"&&Object.keys(e).forEach(function(t){var s=e[t],l=new u(s);i+=`
          if (key.match('`+t+`')) {
            matched = true
            `+l.compile()+`
          }
        `}),i}},{key:"additionalValidations",value:function(){var e=this.schema,i=e.properties,t=e.additionalProperties,s=this.address,l="",c=["matched !== true"];if(Object.keys(i||{}).forEach(function(h){c.push("key !== '"+h+"'")}),(typeof t>"u"?"undefined":p(t))==="object"){var P=t,d=new u(P,{address:s+"[APKey]"});l+=`
        // validate additional properties
        if (`+c.join(" && ")+`) {
          `+d.compile()+`
        }
      `}return t===!1&&(l+=`
        // validate non-presence of additional properties
        if (`+c.join(" && ")+`) {
          valid = false
          errors.push({
            keyword: 'additionalProperties',
            message: key + ' is not a defined property'
          })
        }
      `),l}},{key:"patternProperties",value:function(){var e="";return this.otherPropertiesCalled||(this.otherPropertiesCalled=!0,e+=this.otherProperties()),e}},{key:"additionalProperties",value:function(){var e="";return this.otherPropertiesCalled||(this.otherPropertiesCalled=!0,e+=this.otherProperties()),e}},{key:"minProperties",value:function(){var e=this.schema.minProperties,i=this.address;return`
        // `+i+` min properties
        if (Object.keys(value).length < `+e+`) {
          valid = false
          errors.push({
            keyword: 'minProperties',
            message: 'too few properties'
          })
        }
    `}},{key:"maxProperties",value:function(){var e=this.schema.maxProperties,i=this.address;return`
        // `+i+` max properties
        if (Object.keys(value).length > `+e+`) {
          valid = false
          errors.push({
            keyword: 'maxProperties',
            message: 'too many properties'
          })
        }
    `}},{key:"dependencies",value:function(){var e=this.schema.dependencies,i=this.address,t=this.push();return(typeof e>"u"?"undefined":p(e))==="object"&&Object.keys(e).forEach(function(s){var l=e[s],c=[];if(Array.isArray(l))l.forEach(function(h){c.push("container['"+h+"'] === undefined")}),t+=`
            if (container['`+s+"'] !== undefined && ("+c.join(" || ")+`)) {
              valid = false
              errors.push({
                keyword: 'dependencies',
                message: 'unmet dependencies'
              })
            }
          `;else if((typeof l>"u"?"undefined":p(l))==="object"){var P=l,d=new u(P,{address:i});t+=`
            if (container['`+s+`'] !== undefined) {
              `+d.compile()+`
            }
          `}}),t+=this.pop(),t}},{key:"required",value:function(){this.schema.properties;var e=this.address,i="";return i+=`
      // validate `+e+` presence
      if (value === undefined) {
        valid = false
        errors.push({
          keyword: 'required',
          message: 'is required'
        })
      }
    `,i}},{key:"additionalItems",value:function(){var e=this.schema,i=e.items,t=e.additionalItems;this.address;var s="";if(t===!1&&Array.isArray(i)&&(s+=`
        // don't allow additional items
        if (value.length > `+i.length+`) {
          valid = false
          errors.push({
            keyword: 'additionalItems',
            message: 'additional items not allowed'
          })
        }
      `),(typeof t>"u"?"undefined":p(t))==="object"&&t!==null&&Array.isArray(i)){var l=t,c=new u(l),P=u.counter;s+=`
        // additional items
        `+this.push()+`

        for (var i`+P+" = "+i.length+"; i"+P+" <= container.length; i"+P+`++) {
          value = container[i`+P+`]
          `+c.compile()+`
        }

        `+this.pop()+`
      `}return s}},{key:"items",value:function(){var e=this.schema.items,i=this.address,t="";if(Array.isArray(e))t+=this.push(),e.forEach(function(P,d){var h=P,g=new u(h,{address:i+"["+d+"]"});t+=`
          // item #`+d+`
          value = container[`+d+`]
          `+g.compile()+`
        `}),t+=this.pop();else if((typeof e>"u"?"undefined":p(e))==="object"&&e!==null){var s=e,l=new u(s),c=u.counter;t+=`
        // items
        `+this.push()+`

        for (var i`+c+" = 0; i"+c+" < container.length; i"+c+`++) {
          // read array element
          value = container[i`+c+`]
          `+l.compile()+`
        }

        `+this.pop()+`
      `}return t}},{key:"minItems",value:function(){var e=this.schema.minItems,i=this.address;return`
        // `+i+` min items
        if (value.length < `+e+`) {
          valid = false
          errors.push({
            keyword: 'minItems',
            message: 'too few properties'
          })
        }
    `}},{key:"maxItems",value:function(){var e=this.schema.maxItems,i=this.address;return`
        // `+i+` max items
        if (value.length > `+e+`) {
          valid = false
          errors.push({
            keyword: 'maxItems',
            message: 'too many properties'
          })
        }
    `}},{key:"uniqueItems",value:function(){var e=this.schema.uniqueItems,i=this.address,t="";return e===!0&&(t+=`
        // validate `+i+` unique items
        let values = value.map(v => JSON.stringify(v)) // TODO: optimize
        let set = new Set(values)
        if (values.length !== set.size) {
          valid = false
          errors.push({
            keyword: 'uniqueItems',
            message: 'items must be unique'
          })
        }
      `),t}},{key:"minLength",value:function(){var e=this.schema.minLength,i=this.address;return`
        // `+i+` validate minLength
        if (Array.from(value).length < `+e+`) {
          valid = false
          errors.push({
            keyword: 'minLength',
            message: 'too short'
          })
        }
    `}},{key:"maxLength",value:function(){var e=this.schema.maxLength,i=this.address;return`
        // `+i+` validate maxLength
        if (Array.from(value).length > `+e+`) {
          valid = false
          errors.push({
            keyword: 'maxLength',
            message: 'too long'
          })
        }
    `}},{key:"pattern",value:function(){var e=this.schema.pattern,i=this.address;if(e)return`
          // `+i+` validate pattern
          if (!value.match(new RegExp('`+e+`'))) {
            valid = false
            errors.push({
              keyword: 'pattern',
              message: 'does not match the required pattern'
            })
          }
      `}},{key:"format",value:function(){var e=this.schema.format,i=this.address,t=S.resolve(e);if(t)return`
      // `+i+` validate format
      if (!value.match(`+t+`)) {
        valid = false
        errors.push({
          keyword: 'format',
          message: 'is not "`+e+`" format'
        })
      }
      `}},{key:"minimum",value:function(){var e=this.schema,i=e.minimum,t=e.exclusiveMinimum,s=this.address,l=t===!0?"<=":"<";return`
        // `+s+` validate minimum
        if (value `+l+" "+i+`) {
          valid = false
          errors.push({
            keyword: 'minimum',
            message: 'too small'
          })
        }
    `}},{key:"maximum",value:function(){var e=this.schema,i=e.maximum,t=e.exclusiveMaximum,s=this.address,l=t===!0?">=":">";return`
        // `+s+` validate maximum
        if (value `+l+" "+i+`) {
          valid = false
          errors.push({
            keyword: 'maximum',
            message: 'too large'
          })
        }
    `}},{key:"multipleOf",value:function(){var e=this.schema.multipleOf,i="";if(typeof e=="number"){var t=e.toString().length,s=t-e.toFixed(0).length-1,l=s>0?Math.pow(10,s):1,c=void 0;s>0?c="(value * "+l+") % "+e*l+" !== 0":c="value % "+e+" !== 0",i+=`
        if (`+c+`) {
          valid = false
          errors.push({
            keyword: 'multipleOf',
            message: 'must be a multiple of `+e+`'
          })
        }
      `}return i}}]),u}();I.exports=f},function(I,b,a){var p=a(38),v=a(57),E=a(60),S=a(62),w=a(67),f=a(64),u=a(66),r=a(58),e=a(61),i=a(65),t=a(63);I.exports={JWA:p,JWK:v,JWKSet:E,JWT:S,JWS:w,Base64URLSchema:f,JOSEHeaderSchema:u,JWKSchema:r,JWKSetSchema:e,JWTClaimsSetSchema:i,JWTSchema:t}},function(I,b,a){var p=function(){function u(r,e){for(var i=0;i<e.length;i++){var t=e[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}return function(r,e,i){return e&&u(r.prototype,e),i&&u(r,i),r}}();function v(u,r){if(!(u instanceof r))throw new TypeError("Cannot call a class as a function")}a(39);var E=a(46),S=a(55),w=S.NotSupportedError,f=function(){function u(){v(this,u)}return p(u,null,[{key:"sign",value:function(e,i,t){var s=E.normalize("sign",e);return s instanceof Error?Promise.reject(new w(e)):s.sign(i,t)}},{key:"verify",value:function(e,i,t,s){var l=E.normalize("verify",e);return l instanceof Error?Promise.reject(new w(e)):l.verify(i,t,s)}},{key:"importKey",value:function(e){var i=E.normalize("importKey",e.alg);return i.importKey(e)}}]),u}();I.exports=f},function(I,b,a){I.exports=a(40).default,I.exports.default=I.exports},function(I,b,a){(function(p){Object.defineProperty(b,"__esModule",{value:!0});var v=a(45);function E(e,i){return i===void 0&&(i="utf8"),p.isBuffer(e)?f(e.toString("base64")):f(p.from(e,i).toString("base64"))}function S(e,i){return i===void 0&&(i="utf8"),p.from(w(e),"base64").toString(i)}function w(e){return e=e.toString(),v.default(e).replace(/\-/g,"+").replace(/_/g,"/")}function f(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function u(e){return p.from(w(e),"base64")}var r=E;r.encode=E,r.decode=S,r.toBase64=w,r.fromBase64=f,r.toBuffer=u,b.default=r}).call(this,a(41).Buffer)},function(I,b,a){(function(p){/*!
* The buffer module from node.js, for the browser.
*
* @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
* @license  MIT
*/var v=a(42),E=a(43),S=a(44);b.Buffer=r,b.SlowBuffer=g,b.INSPECT_MAX_BYTES=50,r.TYPED_ARRAY_SUPPORT=p.TYPED_ARRAY_SUPPORT!==void 0?p.TYPED_ARRAY_SUPPORT:w(),b.kMaxLength=f();function w(){try{var y=new Uint8Array(1);return y.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},y.foo()===42&&typeof y.subarray=="function"&&y.subarray(1,1).byteLength===0}catch{return!1}}function f(){return r.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function u(y,n){if(f()<n)throw new RangeError("Invalid typed array length");return r.TYPED_ARRAY_SUPPORT?(y=new Uint8Array(n),y.__proto__=r.prototype):(y===null&&(y=new r(n)),y.length=n),y}function r(y,n,o){if(!r.TYPED_ARRAY_SUPPORT&&!(this instanceof r))return new r(y,n,o);if(typeof y=="number"){if(typeof n=="string")throw new Error("If encoding is specified then the first argument must be a string");return s(this,y)}return e(this,y,n,o)}r.poolSize=8192,r._augment=function(y){return y.__proto__=r.prototype,y};function e(y,n,o,m){if(typeof n=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer?P(y,n,o,m):typeof n=="string"?l(y,n,o):d(y,n)}r.from=function(y,n,o){return e(null,y,n,o)},r.TYPED_ARRAY_SUPPORT&&(r.prototype.__proto__=Uint8Array.prototype,r.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&r[Symbol.species]===r&&Object.defineProperty(r,Symbol.species,{value:null,configurable:!0}));function i(y){if(typeof y!="number")throw new TypeError('"size" argument must be a number');if(y<0)throw new RangeError('"size" argument must not be negative')}function t(y,n,o,m){return i(n),n<=0?u(y,n):o!==void 0?typeof m=="string"?u(y,n).fill(o,m):u(y,n).fill(o):u(y,n)}r.alloc=function(y,n,o){return t(null,y,n,o)};function s(y,n){if(i(n),y=u(y,n<0?0:h(n)|0),!r.TYPED_ARRAY_SUPPORT)for(var o=0;o<n;++o)y[o]=0;return y}r.allocUnsafe=function(y){return s(null,y)},r.allocUnsafeSlow=function(y){return s(null,y)};function l(y,n,o){if((typeof o!="string"||o==="")&&(o="utf8"),!r.isEncoding(o))throw new TypeError('"encoding" must be a valid string encoding');var m=O(n,o)|0;y=u(y,m);var T=y.write(n,o);return T!==m&&(y=y.slice(0,T)),y}function c(y,n){var o=n.length<0?0:h(n.length)|0;y=u(y,o);for(var m=0;m<o;m+=1)y[m]=n[m]&255;return y}function P(y,n,o,m){if(n.byteLength,o<0||n.byteLength<o)throw new RangeError("'offset' is out of bounds");if(n.byteLength<o+(m||0))throw new RangeError("'length' is out of bounds");return o===void 0&&m===void 0?n=new Uint8Array(n):m===void 0?n=new Uint8Array(n,o):n=new Uint8Array(n,o,m),r.TYPED_ARRAY_SUPPORT?(y=n,y.__proto__=r.prototype):y=c(y,n),y}function d(y,n){if(r.isBuffer(n)){var o=h(n.length)|0;return y=u(y,o),y.length===0||n.copy(y,0,0,o),y}if(n){if(typeof ArrayBuffer<"u"&&n.buffer instanceof ArrayBuffer||"length"in n)return typeof n.length!="number"||Ee(n.length)?u(y,0):c(y,n);if(n.type==="Buffer"&&S(n.data))return c(y,n.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function h(y){if(y>=f())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+f().toString(16)+" bytes");return y|0}function g(y){return+y!=y&&(y=0),r.alloc(+y)}r.isBuffer=function(n){return!!(n!=null&&n._isBuffer)},r.compare=function(n,o){if(!r.isBuffer(n)||!r.isBuffer(o))throw new TypeError("Arguments must be Buffers");if(n===o)return 0;for(var m=n.length,T=o.length,M=0,U=Math.min(m,T);M<U;++M)if(n[M]!==o[M]){m=n[M],T=o[M];break}return m<T?-1:T<m?1:0},r.isEncoding=function(n){switch(String(n).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},r.concat=function(n,o){if(!S(n))throw new TypeError('"list" argument must be an Array of Buffers');if(n.length===0)return r.alloc(0);var m;if(o===void 0)for(o=0,m=0;m<n.length;++m)o+=n[m].length;var T=r.allocUnsafe(o),M=0;for(m=0;m<n.length;++m){var U=n[m];if(!r.isBuffer(U))throw new TypeError('"list" argument must be an Array of Buffers');U.copy(T,M),M+=U.length}return T};function O(y,n){if(r.isBuffer(y))return y.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(y)||y instanceof ArrayBuffer))return y.byteLength;typeof y!="string"&&(y=""+y);var o=y.length;if(o===0)return 0;for(var m=!1;;)switch(n){case"ascii":case"latin1":case"binary":return o;case"utf8":case"utf-8":case void 0:return fe(y).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return o*2;case"hex":return o>>>1;case"base64":return ye(y).length;default:if(m)return fe(y).length;n=(""+n).toLowerCase(),m=!0}}r.byteLength=O;function k(y,n,o){var m=!1;if((n===void 0||n<0)&&(n=0),n>this.length||((o===void 0||o>this.length)&&(o=this.length),o<=0)||(o>>>=0,n>>>=0,o<=n))return"";for(y||(y="utf8");;)switch(y){case"hex":return se(this,n,o);case"utf8":case"utf-8":return x(this,n,o);case"ascii":return re(this,n,o);case"latin1":case"binary":return ee(this,n,o);case"base64":return N(this,n,o);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ie(this,n,o);default:if(m)throw new TypeError("Unknown encoding: "+y);y=(y+"").toLowerCase(),m=!0}}r.prototype._isBuffer=!0;function C(y,n,o){var m=y[n];y[n]=y[o],y[o]=m}r.prototype.swap16=function(){var n=this.length;if(n%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var o=0;o<n;o+=2)C(this,o,o+1);return this},r.prototype.swap32=function(){var n=this.length;if(n%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var o=0;o<n;o+=4)C(this,o,o+3),C(this,o+1,o+2);return this},r.prototype.swap64=function(){var n=this.length;if(n%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var o=0;o<n;o+=8)C(this,o,o+7),C(this,o+1,o+6),C(this,o+2,o+5),C(this,o+3,o+4);return this},r.prototype.toString=function(){var n=this.length|0;return n===0?"":arguments.length===0?x(this,0,n):k.apply(this,arguments)},r.prototype.equals=function(n){if(!r.isBuffer(n))throw new TypeError("Argument must be a Buffer");return this===n?!0:r.compare(this,n)===0},r.prototype.inspect=function(){var n="",o=b.INSPECT_MAX_BYTES;return this.length>0&&(n=this.toString("hex",0,o).match(/.{2}/g).join(" "),this.length>o&&(n+=" ... ")),"<Buffer "+n+">"},r.prototype.compare=function(n,o,m,T,M){if(!r.isBuffer(n))throw new TypeError("Argument must be a Buffer");if(o===void 0&&(o=0),m===void 0&&(m=n?n.length:0),T===void 0&&(T=0),M===void 0&&(M=this.length),o<0||m>n.length||T<0||M>this.length)throw new RangeError("out of range index");if(T>=M&&o>=m)return 0;if(T>=M)return-1;if(o>=m)return 1;if(o>>>=0,m>>>=0,T>>>=0,M>>>=0,this===n)return 0;for(var U=M-T,Y=m-o,Q=Math.min(U,Y),_=this.slice(T,M),oe=n.slice(o,m),te=0;te<Q;++te)if(_[te]!==oe[te]){U=_[te],Y=oe[te];break}return U<Y?-1:Y<U?1:0};function B(y,n,o,m,T){if(y.length===0)return-1;if(typeof o=="string"?(m=o,o=0):o>2147483647?o=2147483647:o<-2147483648&&(o=-2147483648),o=+o,isNaN(o)&&(o=T?0:y.length-1),o<0&&(o=y.length+o),o>=y.length){if(T)return-1;o=y.length-1}else if(o<0)if(T)o=0;else return-1;if(typeof n=="string"&&(n=r.from(n,m)),r.isBuffer(n))return n.length===0?-1:J(y,n,o,m,T);if(typeof n=="number")return n=n&255,r.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?T?Uint8Array.prototype.indexOf.call(y,n,o):Uint8Array.prototype.lastIndexOf.call(y,n,o):J(y,[n],o,m,T);throw new TypeError("val must be string, number or Buffer")}function J(y,n,o,m,T){var M=1,U=y.length,Y=n.length;if(m!==void 0&&(m=String(m).toLowerCase(),m==="ucs2"||m==="ucs-2"||m==="utf16le"||m==="utf-16le")){if(y.length<2||n.length<2)return-1;M=2,U/=2,Y/=2,o/=2}function Q(ve,me){return M===1?ve[me]:ve.readUInt16BE(me*M)}var _;if(T){var oe=-1;for(_=o;_<U;_++)if(Q(y,_)===Q(n,oe===-1?0:_-oe)){if(oe===-1&&(oe=_),_-oe+1===Y)return oe*M}else oe!==-1&&(_-=_-oe),oe=-1}else for(o+Y>U&&(o=U-Y),_=o;_>=0;_--){for(var te=!0,he=0;he<Y;he++)if(Q(y,_+he)!==Q(n,he)){te=!1;break}if(te)return _}return-1}r.prototype.includes=function(n,o,m){return this.indexOf(n,o,m)!==-1},r.prototype.indexOf=function(n,o,m){return B(this,n,o,m,!0)},r.prototype.lastIndexOf=function(n,o,m){return B(this,n,o,m,!1)};function $(y,n,o,m){o=Number(o)||0;var T=y.length-o;m?(m=Number(m),m>T&&(m=T)):m=T;var M=n.length;if(M%2!==0)throw new TypeError("Invalid hex string");m>M/2&&(m=M/2);for(var U=0;U<m;++U){var Y=parseInt(n.substr(U*2,2),16);if(isNaN(Y))return U;y[o+U]=Y}return U}function q(y,n,o,m){return ce(fe(n,y.length-o),y,o,m)}function K(y,n,o,m){return ce(le(n),y,o,m)}function W(y,n,o,m){return K(y,n,o,m)}function A(y,n,o,m){return ce(ye(n),y,o,m)}function R(y,n,o,m){return ce(de(n,y.length-o),y,o,m)}r.prototype.write=function(n,o,m,T){if(o===void 0)T="utf8",m=this.length,o=0;else if(m===void 0&&typeof o=="string")T=o,m=this.length,o=0;else if(isFinite(o))o=o|0,isFinite(m)?(m=m|0,T===void 0&&(T="utf8")):(T=m,m=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var M=this.length-o;if((m===void 0||m>M)&&(m=M),n.length>0&&(m<0||o<0)||o>this.length)throw new RangeError("Attempt to write outside buffer bounds");T||(T="utf8");for(var U=!1;;)switch(T){case"hex":return $(this,n,o,m);case"utf8":case"utf-8":return q(this,n,o,m);case"ascii":return K(this,n,o,m);case"latin1":case"binary":return W(this,n,o,m);case"base64":return A(this,n,o,m);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,n,o,m);default:if(U)throw new TypeError("Unknown encoding: "+T);T=(""+T).toLowerCase(),U=!0}},r.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function N(y,n,o){return n===0&&o===y.length?v.fromByteArray(y):v.fromByteArray(y.slice(n,o))}function x(y,n,o){o=Math.min(y.length,o);for(var m=[],T=n;T<o;){var M=y[T],U=null,Y=M>239?4:M>223?3:M>191?2:1;if(T+Y<=o){var Q,_,oe,te;switch(Y){case 1:M<128&&(U=M);break;case 2:Q=y[T+1],(Q&192)===128&&(te=(M&31)<<6|Q&63,te>127&&(U=te));break;case 3:Q=y[T+1],_=y[T+2],(Q&192)===128&&(_&192)===128&&(te=(M&15)<<12|(Q&63)<<6|_&63,te>2047&&(te<55296||te>57343)&&(U=te));break;case 4:Q=y[T+1],_=y[T+2],oe=y[T+3],(Q&192)===128&&(_&192)===128&&(oe&192)===128&&(te=(M&15)<<18|(Q&63)<<12|(_&63)<<6|oe&63,te>65535&&te<1114112&&(U=te))}}U===null?(U=65533,Y=1):U>65535&&(U-=65536,m.push(U>>>10&1023|55296),U=56320|U&1023),m.push(U),T+=Y}return ne(m)}var z=4096;function ne(y){var n=y.length;if(n<=z)return String.fromCharCode.apply(String,y);for(var o="",m=0;m<n;)o+=String.fromCharCode.apply(String,y.slice(m,m+=z));return o}function re(y,n,o){var m="";o=Math.min(y.length,o);for(var T=n;T<o;++T)m+=String.fromCharCode(y[T]&127);return m}function ee(y,n,o){var m="";o=Math.min(y.length,o);for(var T=n;T<o;++T)m+=String.fromCharCode(y[T]);return m}function se(y,n,o){var m=y.length;(!n||n<0)&&(n=0),(!o||o<0||o>m)&&(o=m);for(var T="",M=n;M<o;++M)T+=ue(y[M]);return T}function ie(y,n,o){for(var m=y.slice(n,o),T="",M=0;M<m.length;M+=2)T+=String.fromCharCode(m[M]+m[M+1]*256);return T}r.prototype.slice=function(n,o){var m=this.length;n=~~n,o=o===void 0?m:~~o,n<0?(n+=m,n<0&&(n=0)):n>m&&(n=m),o<0?(o+=m,o<0&&(o=0)):o>m&&(o=m),o<n&&(o=n);var T;if(r.TYPED_ARRAY_SUPPORT)T=this.subarray(n,o),T.__proto__=r.prototype;else{var M=o-n;T=new r(M,void 0);for(var U=0;U<M;++U)T[U]=this[U+n]}return T};function j(y,n,o){if(y%1!==0||y<0)throw new RangeError("offset is not uint");if(y+n>o)throw new RangeError("Trying to access beyond buffer length")}r.prototype.readUIntLE=function(n,o,m){n=n|0,o=o|0,m||j(n,o,this.length);for(var T=this[n],M=1,U=0;++U<o&&(M*=256);)T+=this[n+U]*M;return T},r.prototype.readUIntBE=function(n,o,m){n=n|0,o=o|0,m||j(n,o,this.length);for(var T=this[n+--o],M=1;o>0&&(M*=256);)T+=this[n+--o]*M;return T},r.prototype.readUInt8=function(n,o){return o||j(n,1,this.length),this[n]},r.prototype.readUInt16LE=function(n,o){return o||j(n,2,this.length),this[n]|this[n+1]<<8},r.prototype.readUInt16BE=function(n,o){return o||j(n,2,this.length),this[n]<<8|this[n+1]},r.prototype.readUInt32LE=function(n,o){return o||j(n,4,this.length),(this[n]|this[n+1]<<8|this[n+2]<<16)+this[n+3]*16777216},r.prototype.readUInt32BE=function(n,o){return o||j(n,4,this.length),this[n]*16777216+(this[n+1]<<16|this[n+2]<<8|this[n+3])},r.prototype.readIntLE=function(n,o,m){n=n|0,o=o|0,m||j(n,o,this.length);for(var T=this[n],M=1,U=0;++U<o&&(M*=256);)T+=this[n+U]*M;return M*=128,T>=M&&(T-=Math.pow(2,8*o)),T},r.prototype.readIntBE=function(n,o,m){n=n|0,o=o|0,m||j(n,o,this.length);for(var T=o,M=1,U=this[n+--T];T>0&&(M*=256);)U+=this[n+--T]*M;return M*=128,U>=M&&(U-=Math.pow(2,8*o)),U},r.prototype.readInt8=function(n,o){return o||j(n,1,this.length),this[n]&128?(255-this[n]+1)*-1:this[n]},r.prototype.readInt16LE=function(n,o){o||j(n,2,this.length);var m=this[n]|this[n+1]<<8;return m&32768?m|4294901760:m},r.prototype.readInt16BE=function(n,o){o||j(n,2,this.length);var m=this[n+1]|this[n]<<8;return m&32768?m|4294901760:m},r.prototype.readInt32LE=function(n,o){return o||j(n,4,this.length),this[n]|this[n+1]<<8|this[n+2]<<16|this[n+3]<<24},r.prototype.readInt32BE=function(n,o){return o||j(n,4,this.length),this[n]<<24|this[n+1]<<16|this[n+2]<<8|this[n+3]},r.prototype.readFloatLE=function(n,o){return o||j(n,4,this.length),E.read(this,n,!0,23,4)},r.prototype.readFloatBE=function(n,o){return o||j(n,4,this.length),E.read(this,n,!1,23,4)},r.prototype.readDoubleLE=function(n,o){return o||j(n,8,this.length),E.read(this,n,!0,52,8)},r.prototype.readDoubleBE=function(n,o){return o||j(n,8,this.length),E.read(this,n,!1,52,8)};function D(y,n,o,m,T,M){if(!r.isBuffer(y))throw new TypeError('"buffer" argument must be a Buffer instance');if(n>T||n<M)throw new RangeError('"value" argument is out of bounds');if(o+m>y.length)throw new RangeError("Index out of range")}r.prototype.writeUIntLE=function(n,o,m,T){if(n=+n,o=o|0,m=m|0,!T){var M=Math.pow(2,8*m)-1;D(this,n,o,m,M,0)}var U=1,Y=0;for(this[o]=n&255;++Y<m&&(U*=256);)this[o+Y]=n/U&255;return o+m},r.prototype.writeUIntBE=function(n,o,m,T){if(n=+n,o=o|0,m=m|0,!T){var M=Math.pow(2,8*m)-1;D(this,n,o,m,M,0)}var U=m-1,Y=1;for(this[o+U]=n&255;--U>=0&&(Y*=256);)this[o+U]=n/Y&255;return o+m},r.prototype.writeUInt8=function(n,o,m){return n=+n,o=o|0,m||D(this,n,o,1,255,0),r.TYPED_ARRAY_SUPPORT||(n=Math.floor(n)),this[o]=n&255,o+1};function L(y,n,o,m){n<0&&(n=65535+n+1);for(var T=0,M=Math.min(y.length-o,2);T<M;++T)y[o+T]=(n&255<<8*(m?T:1-T))>>>(m?T:1-T)*8}r.prototype.writeUInt16LE=function(n,o,m){return n=+n,o=o|0,m||D(this,n,o,2,65535,0),r.TYPED_ARRAY_SUPPORT?(this[o]=n&255,this[o+1]=n>>>8):L(this,n,o,!0),o+2},r.prototype.writeUInt16BE=function(n,o,m){return n=+n,o=o|0,m||D(this,n,o,2,65535,0),r.TYPED_ARRAY_SUPPORT?(this[o]=n>>>8,this[o+1]=n&255):L(this,n,o,!1),o+2};function H(y,n,o,m){n<0&&(n=4294967295+n+1);for(var T=0,M=Math.min(y.length-o,4);T<M;++T)y[o+T]=n>>>(m?T:3-T)*8&255}r.prototype.writeUInt32LE=function(n,o,m){return n=+n,o=o|0,m||D(this,n,o,4,4294967295,0),r.TYPED_ARRAY_SUPPORT?(this[o+3]=n>>>24,this[o+2]=n>>>16,this[o+1]=n>>>8,this[o]=n&255):H(this,n,o,!0),o+4},r.prototype.writeUInt32BE=function(n,o,m){return n=+n,o=o|0,m||D(this,n,o,4,4294967295,0),r.TYPED_ARRAY_SUPPORT?(this[o]=n>>>24,this[o+1]=n>>>16,this[o+2]=n>>>8,this[o+3]=n&255):H(this,n,o,!1),o+4},r.prototype.writeIntLE=function(n,o,m,T){if(n=+n,o=o|0,!T){var M=Math.pow(2,8*m-1);D(this,n,o,m,M-1,-M)}var U=0,Y=1,Q=0;for(this[o]=n&255;++U<m&&(Y*=256);)n<0&&Q===0&&this[o+U-1]!==0&&(Q=1),this[o+U]=(n/Y>>0)-Q&255;return o+m},r.prototype.writeIntBE=function(n,o,m,T){if(n=+n,o=o|0,!T){var M=Math.pow(2,8*m-1);D(this,n,o,m,M-1,-M)}var U=m-1,Y=1,Q=0;for(this[o+U]=n&255;--U>=0&&(Y*=256);)n<0&&Q===0&&this[o+U+1]!==0&&(Q=1),this[o+U]=(n/Y>>0)-Q&255;return o+m},r.prototype.writeInt8=function(n,o,m){return n=+n,o=o|0,m||D(this,n,o,1,127,-128),r.TYPED_ARRAY_SUPPORT||(n=Math.floor(n)),n<0&&(n=255+n+1),this[o]=n&255,o+1},r.prototype.writeInt16LE=function(n,o,m){return n=+n,o=o|0,m||D(this,n,o,2,32767,-32768),r.TYPED_ARRAY_SUPPORT?(this[o]=n&255,this[o+1]=n>>>8):L(this,n,o,!0),o+2},r.prototype.writeInt16BE=function(n,o,m){return n=+n,o=o|0,m||D(this,n,o,2,32767,-32768),r.TYPED_ARRAY_SUPPORT?(this[o]=n>>>8,this[o+1]=n&255):L(this,n,o,!1),o+2},r.prototype.writeInt32LE=function(n,o,m){return n=+n,o=o|0,m||D(this,n,o,4,2147483647,-2147483648),r.TYPED_ARRAY_SUPPORT?(this[o]=n&255,this[o+1]=n>>>8,this[o+2]=n>>>16,this[o+3]=n>>>24):H(this,n,o,!0),o+4},r.prototype.writeInt32BE=function(n,o,m){return n=+n,o=o|0,m||D(this,n,o,4,2147483647,-2147483648),n<0&&(n=4294967295+n+1),r.TYPED_ARRAY_SUPPORT?(this[o]=n>>>24,this[o+1]=n>>>16,this[o+2]=n>>>8,this[o+3]=n&255):H(this,n,o,!1),o+4};function G(y,n,o,m,T,M){if(o+m>y.length)throw new RangeError("Index out of range");if(o<0)throw new RangeError("Index out of range")}function X(y,n,o,m,T){return T||G(y,n,o,4),E.write(y,n,o,m,23,4),o+4}r.prototype.writeFloatLE=function(n,o,m){return X(this,n,o,!0,m)},r.prototype.writeFloatBE=function(n,o,m){return X(this,n,o,!1,m)};function F(y,n,o,m,T){return T||G(y,n,o,8),E.write(y,n,o,m,52,8),o+8}r.prototype.writeDoubleLE=function(n,o,m){return F(this,n,o,!0,m)},r.prototype.writeDoubleBE=function(n,o,m){return F(this,n,o,!1,m)},r.prototype.copy=function(n,o,m,T){if(m||(m=0),!T&&T!==0&&(T=this.length),o>=n.length&&(o=n.length),o||(o=0),T>0&&T<m&&(T=m),T===m||n.length===0||this.length===0)return 0;if(o<0)throw new RangeError("targetStart out of bounds");if(m<0||m>=this.length)throw new RangeError("sourceStart out of bounds");if(T<0)throw new RangeError("sourceEnd out of bounds");T>this.length&&(T=this.length),n.length-o<T-m&&(T=n.length-o+m);var M=T-m,U;if(this===n&&m<o&&o<T)for(U=M-1;U>=0;--U)n[U+o]=this[U+m];else if(M<1e3||!r.TYPED_ARRAY_SUPPORT)for(U=0;U<M;++U)n[U+o]=this[U+m];else Uint8Array.prototype.set.call(n,this.subarray(m,m+M),o);return M},r.prototype.fill=function(n,o,m,T){if(typeof n=="string"){if(typeof o=="string"?(T=o,o=0,m=this.length):typeof m=="string"&&(T=m,m=this.length),n.length===1){var M=n.charCodeAt(0);M<256&&(n=M)}if(T!==void 0&&typeof T!="string")throw new TypeError("encoding must be a string");if(typeof T=="string"&&!r.isEncoding(T))throw new TypeError("Unknown encoding: "+T)}else typeof n=="number"&&(n=n&255);if(o<0||this.length<o||this.length<m)throw new RangeError("Out of range index");if(m<=o)return this;o=o>>>0,m=m===void 0?this.length:m>>>0,n||(n=0);var U;if(typeof n=="number")for(U=o;U<m;++U)this[U]=n;else{var Y=r.isBuffer(n)?n:fe(new r(n,T).toString()),Q=Y.length;for(U=0;U<m-o;++U)this[U+o]=Y[U%Q]}return this};var V=/[^+\/0-9A-Za-z-_]/g;function Z(y){if(y=ae(y).replace(V,""),y.length<2)return"";for(;y.length%4!==0;)y=y+"=";return y}function ae(y){return y.trim?y.trim():y.replace(/^\s+|\s+$/g,"")}function ue(y){return y<16?"0"+y.toString(16):y.toString(16)}function fe(y,n){n=n||1/0;for(var o,m=y.length,T=null,M=[],U=0;U<m;++U){if(o=y.charCodeAt(U),o>55295&&o<57344){if(!T){if(o>56319){(n-=3)>-1&&M.push(239,191,189);continue}else if(U+1===m){(n-=3)>-1&&M.push(239,191,189);continue}T=o;continue}if(o<56320){(n-=3)>-1&&M.push(239,191,189),T=o;continue}o=(T-55296<<10|o-56320)+65536}else T&&(n-=3)>-1&&M.push(239,191,189);if(T=null,o<128){if((n-=1)<0)break;M.push(o)}else if(o<2048){if((n-=2)<0)break;M.push(o>>6|192,o&63|128)}else if(o<65536){if((n-=3)<0)break;M.push(o>>12|224,o>>6&63|128,o&63|128)}else if(o<1114112){if((n-=4)<0)break;M.push(o>>18|240,o>>12&63|128,o>>6&63|128,o&63|128)}else throw new Error("Invalid code point")}return M}function le(y){for(var n=[],o=0;o<y.length;++o)n.push(y.charCodeAt(o)&255);return n}function de(y,n){for(var o,m,T,M=[],U=0;U<y.length&&!((n-=2)<0);++U)o=y.charCodeAt(U),m=o>>8,T=o%256,M.push(T),M.push(m);return M}function ye(y){return v.toByteArray(Z(y))}function ce(y,n,o,m){for(var T=0;T<m&&!(T+o>=n.length||T>=y.length);++T)n[T+o]=y[T];return T}function Ee(y){return y!==y}}).call(this,a(20))},function(I,b,a){b.byteLength=r,b.toByteArray=i,b.fromByteArray=l;for(var p=[],v=[],E=typeof Uint8Array<"u"?Uint8Array:Array,S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",w=0,f=S.length;w<f;++w)p[w]=S[w],v[S.charCodeAt(w)]=w;v[45]=62,v[95]=63;function u(c){var P=c.length;if(P%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var d=c.indexOf("=");d===-1&&(d=P);var h=d===P?0:4-d%4;return[d,h]}function r(c){var P=u(c),d=P[0],h=P[1];return(d+h)*3/4-h}function e(c,P,d){return(P+d)*3/4-d}function i(c){var P,d=u(c),h=d[0],g=d[1],O=new E(e(c,h,g)),k=0,C=g>0?h-4:h,B;for(B=0;B<C;B+=4)P=v[c.charCodeAt(B)]<<18|v[c.charCodeAt(B+1)]<<12|v[c.charCodeAt(B+2)]<<6|v[c.charCodeAt(B+3)],O[k++]=P>>16&255,O[k++]=P>>8&255,O[k++]=P&255;return g===2&&(P=v[c.charCodeAt(B)]<<2|v[c.charCodeAt(B+1)]>>4,O[k++]=P&255),g===1&&(P=v[c.charCodeAt(B)]<<10|v[c.charCodeAt(B+1)]<<4|v[c.charCodeAt(B+2)]>>2,O[k++]=P>>8&255,O[k++]=P&255),O}function t(c){return p[c>>18&63]+p[c>>12&63]+p[c>>6&63]+p[c&63]}function s(c,P,d){for(var h,g=[],O=P;O<d;O+=3)h=(c[O]<<16&16711680)+(c[O+1]<<8&65280)+(c[O+2]&255),g.push(t(h));return g.join("")}function l(c){for(var P,d=c.length,h=d%3,g=[],O=16383,k=0,C=d-h;k<C;k+=O)g.push(s(c,k,k+O>C?C:k+O));return h===1?(P=c[d-1],g.push(p[P>>2]+p[P<<4&63]+"==")):h===2&&(P=(c[d-2]<<8)+c[d-1],g.push(p[P>>10]+p[P>>4&63]+p[P<<2&63]+"=")),g.join("")}},function(I,b){b.read=function(a,p,v,E,S){var w,f,u=S*8-E-1,r=(1<<u)-1,e=r>>1,i=-7,t=v?S-1:0,s=v?-1:1,l=a[p+t];for(t+=s,w=l&(1<<-i)-1,l>>=-i,i+=u;i>0;w=w*256+a[p+t],t+=s,i-=8);for(f=w&(1<<-i)-1,w>>=-i,i+=E;i>0;f=f*256+a[p+t],t+=s,i-=8);if(w===0)w=1-e;else{if(w===r)return f?NaN:(l?-1:1)*(1/0);f=f+Math.pow(2,E),w=w-e}return(l?-1:1)*f*Math.pow(2,w-E)},b.write=function(a,p,v,E,S,w){var f,u,r,e=w*8-S-1,i=(1<<e)-1,t=i>>1,s=S===23?Math.pow(2,-24)-Math.pow(2,-77):0,l=E?0:w-1,c=E?1:-1,P=p<0||p===0&&1/p<0?1:0;for(p=Math.abs(p),isNaN(p)||p===1/0?(u=isNaN(p)?1:0,f=i):(f=Math.floor(Math.log(p)/Math.LN2),p*(r=Math.pow(2,-f))<1&&(f--,r*=2),f+t>=1?p+=s/r:p+=s*Math.pow(2,1-t),p*r>=2&&(f++,r/=2),f+t>=i?(u=0,f=i):f+t>=1?(u=(p*r-1)*Math.pow(2,S),f=f+t):(u=p*Math.pow(2,t-1)*Math.pow(2,S),f=0));S>=8;a[v+l]=u&255,l+=c,u/=256,S-=8);for(f=f<<S|u,e+=S;e>0;a[v+l]=f&255,l+=c,f/=256,e-=8);a[v+l-c]|=P*128}},function(I,b){var a={}.toString;I.exports=Array.isArray||function(p){return a.call(p)=="[object Array]"}},function(I,b,a){(function(p){Object.defineProperty(b,"__esModule",{value:!0});function v(E){var S=4,w=E.length,f=w%S;if(!f)return E;var u=w,r=S-f,e=w+r,i=p.alloc(e);for(i.write(E);r--;)i.write("=",u++);return i.toString()}b.default=v}).call(this,a(41).Buffer)},function(I,b,a){var p=a(47),v=a(48),E=a(52),S=a(53),w=new S;w.define("HS256","sign",new v({name:"HMAC",hash:{name:"SHA-256"}})),w.define("HS384","sign",new v({name:"HMAC",hash:{name:"SHA-384"}})),w.define("HS512","sign",new v({name:"HMAC",hash:{name:"SHA-512"}})),w.define("RS256","sign",new E({name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}})),w.define("RS384","sign",new E({name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}})),w.define("RS512","sign",new E({name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}})),w.define("none","sign",new p({})),w.define("HS256","verify",new v({name:"HMAC",hash:{name:"SHA-256"}})),w.define("HS384","verify",new v({name:"HMAC",hash:{name:"SHA-384"}})),w.define("HS512","verify",new v({name:"HMAC",hash:{name:"SHA-512"}})),w.define("RS256","verify",new E({name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}})),w.define("RS384","verify",new E({name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}})),w.define("RS512","verify",new E({name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}})),w.define("none","verify",new p({})),w.define("RS256","importKey",new E({name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}})),w.define("RS384","importKey",new E({name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}})),w.define("RS512","importKey",new E({name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}})),I.exports=w},function(I,b,a){var p=function(){function S(w,f){for(var u=0;u<f.length;u++){var r=f[u];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(w,r.key,r)}}return function(w,f,u){return f&&S(w.prototype,f),u&&S(w,u),w}}();function v(S,w){if(!(S instanceof w))throw new TypeError("Cannot call a class as a function")}var E=function(){function S(){v(this,S)}return p(S,[{key:"sign",value:function(){return Promise.resolve("")}},{key:"verify",value:function(){}}]),S}();I.exports=E},function(I,b,a){(function(p){var v=function(){function r(e,i){for(var t=0;t<i.length;t++){var s=i[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,i,t){return i&&r(e.prototype,i),t&&r(e,t),e}}();function E(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}var S=a(39),w=a(49),f=a(50),u=function(){function r(e){E(this,r),this.params=e}return v(r,[{key:"sign",value:function(i,t){var s=this.params;return t=new f().encode(t),w.subtle.sign(s,i,t).then(function(l){return S(p.from(l))})}},{key:"verify",value:function(i,t,s){var l=this.params;return typeof t=="string"&&(t=Uint8Array.from(S.toBuffer(t))),typeof s=="string"&&(s=new f().encode(s)),w.subtle.verify(l,i,t,s)}},{key:"assertSufficientKeyLength",value:function(i){if(i.length<this.bitlength)throw new Error("The key is too short.")}}]),r}();I.exports=u}).call(this,a(41).Buffer)},function(I,b){(function(){I.exports=window.crypto})()},function(I,b,a){(function(p){var v=p.TextEncoder?p.TextEncoder:a(51).TextEncoder;I.exports=v}).call(this,a(20))},function(I,b){(function(){I.exports=window.TextEncoder})()},function(I,b,a){(function(p){var v=function(){function r(e,i){for(var t=0;t<i.length;t++){var s=i[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,i,t){return i&&r(e.prototype,i),t&&r(e,t),e}}();function E(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}var S=a(39),w=a(49),f=a(50),u=function(){function r(e){E(this,r),this.params=e}return v(r,[{key:"sign",value:function(i,t){var s=this.params;return t=new f().encode(t),w.subtle.sign(s,i,t).then(function(l){return S(p.from(l))})}},{key:"verify",value:function(i,t,s){var l=this.params;return typeof t=="string"&&(t=Uint8Array.from(S.toBuffer(t))),typeof s=="string"&&(s=new f().encode(s)),w.subtle.verify(l,i,t,s)}},{key:"importKey",value:function(i){var t=Object.assign({},i),s=this.params,l=i.key_ops||[];return i.use==="sig"&&l.push("verify"),i.use==="enc"?Promise.resolve(i):(i.key_ops&&(l=i.key_ops),w.subtle.importKey("jwk",t,s,!0,l).then(function(c){return Object.defineProperty(t,"cryptoKey",{enumerable:!1,value:c}),t}))}}]),r}();I.exports=u}).call(this,a(41).Buffer)},function(I,b,a){var p=function(){function f(u,r){for(var e=0;e<r.length;e++){var i=r[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(u,i.key,i)}}return function(u,r,e){return r&&f(u.prototype,r),e&&f(u,e),u}}();function v(f,u){if(!(f instanceof u))throw new TypeError("Cannot call a class as a function")}var E=a(54),S=["sign","verify","encrypt","decrypt","importKey"],w=function(){function f(){var u=this;v(this,f),S.forEach(function(r){u[r]={}})}return p(f,[{key:"define",value:function(r,e,i){var t=this[e];t[r]=i}},{key:"normalize",value:function(r,e){var i=this[r];if(!i)return new SyntaxError;var t=i[e];return t||new E(e)}}],[{key:"operations",get:function(){return S}}]),f}();I.exports=w},function(I,b,a){function p(w,f){if(!(w instanceof f))throw new TypeError("Cannot call a class as a function")}function v(w,f){if(!w)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return f&&(typeof f=="object"||typeof f=="function")?f:w}function E(w,f){if(typeof f!="function"&&f!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof f);w.prototype=Object.create(f&&f.prototype,{constructor:{value:w,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(w,f):w.__proto__=f)}var S=function(w){E(f,w);function f(u){p(this,f);var r=v(this,(f.__proto__||Object.getPrototypeOf(f)).call(this));return r.message=u+" is not a supported algorithm",r}return f}(Error);I.exports=S},function(I,b,a){I.exports={DataError:a(56),NotSupportedError:a(54)}},function(I,b,a){function p(w,f){if(!(w instanceof f))throw new TypeError("Cannot call a class as a function")}function v(w,f){if(!w)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return f&&(typeof f=="object"||typeof f=="function")?f:w}function E(w,f){if(typeof f!="function"&&f!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof f);w.prototype=Object.create(f&&f.prototype,{constructor:{value:w,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(w,f):w.__proto__=f)}var S=function(w){E(f,w);function f(u){return p(this,f),v(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,u))}return f}(Error);I.exports=S},function(I,b,a){var p=function(){function i(t,s){for(var l=0;l<s.length;l++){var c=s[l];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,c.key,c)}}return function(t,s,l){return s&&i(t.prototype,s),l&&i(t,l),t}}();function v(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function E(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function S(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var w=a(28),f=w.JSONDocument,u=a(58),r=a(38),e=function(i){S(t,i);function t(){return v(this,t),E(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p(t,null,[{key:"importKey",value:function(l){return r.importKey(l)}},{key:"schema",get:function(){return u}}]),t}(f);I.exports=e},function(I,b,a){var p=a(28),v=p.JSONSchema,E=a(59);E.BASE64_REGEXP;var S=new v({type:"object",properties:{kty:{type:"string",enum:["RSA","EC","oct"]},use:{type:"string",enum:["sig","enc"]},key_ops:{type:"array",items:{enum:["sign","verify","encrypt","decrypt","wrapKey","unwrapKey","deriveKey","deriveBits"]}},alg:{type:"string",enum:["HS256","HS384","HS512","RS256","RS384","RS512","ES256","ES384","ES512","PS256","PS384","PS512","none"]},kid:{type:"string"},x5u:{type:"string"},x5c:{type:"array"},x5t:{type:"string"}}});I.exports=S},function(I,b,a){var p=a(28),v=p.Formats;v.register("StringOrURI",new RegExp),v.register("NumericDate",new RegExp),v.register("URI",new RegExp),v.register("url",new RegExp),v.register("base64",new RegExp),v.register("base64url",new RegExp),v.register("MediaType",new RegExp)},function(I,b,a){var p=function(){function i(t,s){for(var l=0;l<s.length;l++){var c=s[l];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,c.key,c)}}return function(t,s,l){return s&&i(t.prototype,s),l&&i(t,l),t}}();function v(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function E(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function S(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var w=a(28),f=w.JSONDocument,u=a(61),r=a(57),e=function(i){S(t,i);function t(){return v(this,t),E(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p(t,null,[{key:"importKeys",value:function(l){var c=this.schema.validate(l);if(!c.valid)return Promise.reject(new Error("Invalid JWKSet: "+JSON.stringify(c,null,2)));if(!l.keys)return Promise.reject(new Error("Cannot import JWKSet: keys property is empty"));var P=void 0,d=void 0;try{P=new t(l),d=l.keys.map(function(h){return r.importKey(h)})}catch(h){return Promise.reject(h)}return Promise.all(d).then(function(h){return P.keys=h,P})}},{key:"schema",get:function(){return u}}]),t}(f);I.exports=e},function(I,b,a){var p=a(28),v=p.JSONSchema,E=a(58),S=new v({type:"object",properties:{keys:{type:"array",items:E}}});I.exports=S},function(I,b,a){var p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(l){return typeof l}:function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},v=function(){function l(c,P){for(var d=0;d<P.length;d++){var h=P[d];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(c,h.key,h)}}return function(c,P,d){return P&&l(c.prototype,P),d&&l(c,d),c}}();function E(l,c){if(!(l instanceof c))throw new TypeError("Cannot call a class as a function")}function S(l,c){if(!l)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return c&&(typeof c=="object"||typeof c=="function")?c:l}function w(l,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof c);l.prototype=Object.create(c&&c.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),c&&(Object.setPrototypeOf?Object.setPrototypeOf(l,c):l.__proto__=c)}var f=a(39),u=a(28),r=u.JSONDocument,e=a(63),i=a(67),t=a(56),s=function(l){w(c,l);function c(){return E(this,c),S(this,(c.__proto__||Object.getPrototypeOf(c)).apply(this,arguments))}return v(c,[{key:"isJWE",value:function(){return!!this.header.enc}},{key:"resolveKeys",value:function(d){var h=this.header.kid,g=void 0,O=void 0;if(Array.isArray(d)&&(g=d),d.keys&&(g=d.keys),!d.keys&&(typeof d>"u"?"undefined":p(d))==="object"&&(g=[d]),!g)throw new t("Invalid JWK argument");return h?O=g.find(function(k){return k.kid===h}):O=g.find(function(k){return k.use==="sig"}),O?(this.key=O.cryptoKey,!0):!1}},{key:"encode",value:function(){var d=this.validate();if(!d.valid)return Promise.reject(d);var h=this;return this.isJWE()?JWE.encrypt(h):i.sign(h)}},{key:"verify",value:function(){var d=this.validate();return d.valid?i.verify(this):Promise.reject(d)}}],[{key:"decode",value:function(d){var h=this,g=void 0;if(typeof d!="string")throw new t("JWT must be a string");if(d.startsWith("{")){try{d=JSON.parse(d,function(){})}catch{throw new t("Invalid JWT serialization")}d.signatures||d.recipients?d.serialization="json":d.serialization="flattened",g=new h(d,{filter:!1})}else try{var O="compact",k=d.split("."),C=k.length;if(C!==3&&C!==5)throw new Error("Malformed JWT");var B=JSON.parse(f.decode(k[0]));if(C===3){var J="JWS",$=JSON.parse(f.decode(k[1])),q=k[2];g=new h({type:J,segments:k,header:B,payload:$,signature:q,serialization:O},{filter:!1})}}catch{throw new t("Invalid JWT compact serialization")}return g}},{key:"encode",value:function(d,h,g){var O=new c(d,h);return O.encode(g)}},{key:"verify",value:function(d,h){var g=c.decode(h);return g.key=d,g.verify().then(function(O){return g})}},{key:"schema",get:function(){return e}}]),c}(r);I.exports=s},function(I,b,a){var p=a(64),v=a(65),E=a(66),S=a(28),w=S.JSONSchema,f=new w({type:"object",properties:{type:{type:"string",enum:["JWS","JWE"]},segments:{type:"array"},header:E,protected:E,unprotected:E,iv:p,aad:p,ciphertext:p,tag:p,recipients:{type:"array",items:{type:"object",properties:{header:E,encrypted_key:p}}},payload:v,signatures:{type:"array",items:{type:"object",properties:{protected:E,header:E,signature:p,key:{type:"object"}}}},signature:p,verified:{type:"boolean",default:!1},key:{type:"object"},serialization:{type:"string",enum:["compact","json","flattened"],default:"compact"}}});I.exports=f},function(I,b,a){var p=a(28),v=p.JSONSchema,E=new v({type:"string",format:"base64url"});I.exports=E},function(I,b,a){var p=a(28),v=p.JSONSchema,E=new v({properties:{iss:{type:"string",format:"StringOrURI"},sub:{type:"string",format:"StringOrURI"},aud:{type:["array","string"],format:"StringOrURI",items:{format:"StringOrURI"}},exp:{type:"number",format:"NumericDate"},nbf:{type:"number",format:"NumericDate"},iat:{type:"number",format:"NumericDate"},jti:{type:"string"}}});I.exports=E},function(I,b,a){a(58);var p=a(28),v=p.JSONSchema,E=new v({type:"object",properties:{typ:{type:"string"},cty:{type:"string",enum:["JWT"]},alg:{type:"string",format:"StringOrURI"},jku:{type:"string",format:"URI"},kid:{type:"string"},x5u:{type:"string",format:"URI"},x5c:{type:"array",items:{type:"string",format:"base64"}},x5t:{type:"string",format:"base64url"},crit:{type:"array",items:{type:"string"},minItems:1},enc:{type:"string",format:"StringOrURI"},zip:{type:"string"}}});I.exports=E},function(I,b,a){var p=function(){function e(i,t){var s=[],l=!0,c=!1,P=void 0;try{for(var d=i[Symbol.iterator](),h;!(l=(h=d.next()).done)&&(s.push(h.value),!(t&&s.length===t));l=!0);}catch(g){c=!0,P=g}finally{try{!l&&d.return&&d.return()}finally{if(c)throw P}}return s}return function(i,t){if(Array.isArray(i))return i;if(Symbol.iterator in Object(i))return e(i,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),v=function(){function e(i,t){for(var s=0;s<t.length;s++){var l=t[s];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(i,l.key,l)}}return function(i,t,s){return t&&e(i.prototype,t),s&&e(i,s),i}}();function E(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}var S=a(39),w=a(38),f=a(55),u=f.DataError,r=function(){function e(){E(this,e)}return v(e,null,[{key:"sign",value:function(t){var s=S(JSON.stringify(t.payload));if(t.serialization==="compact"){var l=t.key,c=t.header.alg,P=S(JSON.stringify(t.header)),d=P+"."+s;return w.sign(c,l,d).then(function(h){return d+"."+h})}return t.serialization,t.serialization,Promise.reject(new u("Unsupported serialization"))}},{key:"verify",value:function(t){t.signatures;var s=t.key,l=t.signature,c=t.header.alg;if(t.signature){var P=p(t.segments,2),d=P[0],h=P[1],g=d+"."+h;return c==="none"?Promise.reject(new u("Signature provided to verify with alg: none")):w.verify(c,s,l,g).then(function(O){return t.verified=O,O})}if(c==="none"){if(!s&&!l)return t.verified=!0,Promise.resolve(!0);if(s)return Promise.reject(new u("Key provided to verify signature with alg: none"))}return Promise.reject(new u("Missing signature(s)"))}}]),e}();I.exports=r},function(I,b,a){(function(p){const v=a(21),E=a(39),S=a(49),{JWT:w}=a(37),f=a(69),{URL:u}=a(27);class r{static create(i,t,s){const{provider:l,defaults:c,registration:P}=i;let d,h,g,O;return Promise.resolve().then(()=>(v(l.configuration,"RelyingParty provider OpenID Configuration is missing"),v(c.authenticate,"RelyingParty default authentication parameters are missing"),v(P,"RelyingParty client registration is missing"),d=l.configuration.issuer,h=l.configuration.authorization_endpoint,g={client_id:P.client_id},O=Object.assign(c.authenticate,g,t),v(d,"Missing issuer in provider OpenID Configuration"),v(h,"Missing authorization_endpoint in provider OpenID Configuration"),v(O.scope,"Missing scope parameter in authentication request"),v(O.response_type,"Missing response_type parameter in authentication request"),v(O.client_id,"Missing client_id parameter in authentication request"),v(O.redirect_uri,"Missing redirect_uri parameter in authentication request"),O.state=Array.from(S.getRandomValues(new Uint8Array(16))),O.nonce=Array.from(S.getRandomValues(new Uint8Array(16))),Promise.all([S.subtle.digest({name:"SHA-256"},new Uint8Array(O.state)),S.subtle.digest({name:"SHA-256"},new Uint8Array(O.nonce))]))).then(k=>{let C=E(p.from(k[0])),B=E(p.from(k[1])),J=`${d}/requestHistory/${C}`;s[J]=JSON.stringify(O),O.state=C,O.nonce=B}).then(()=>r.generateSessionKeys()).then(k=>{r.storeSessionKeys(k,O,s)}).then(()=>{if(l.configuration.request_parameter_supported)return r.encodeRequestParams(O).then(k=>{O=k})}).then(()=>{let k=new u(h);return k.search=f.encode(O),k.href})}static generateSessionKeys(){return S.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]).then(i=>Promise.all([S.subtle.exportKey("jwk",i.publicKey),S.subtle.exportKey("jwk",i.privateKey)])).then(i=>{let[t,s]=i;return{public:t,private:s}})}static storeSessionKeys(i,t,s){s["oidc.session.privateKey"]=JSON.stringify(i.private),t.key=i.public}static encodeRequestParams(i){const t=["scope","client_id","response_type","state"],s=Object.keys(i).filter(P=>!t.includes(P));let l={};return s.forEach(P=>{l[P]=i[P]}),new w({header:{alg:"none"},payload:l},{filter:!1}).encode().then(P=>({scope:i.scope,client_id:i.client_id,response_type:i.response_type,request:P,state:i.state}))}}I.exports=r}).call(this,a(41).Buffer)},function(I,b){class a{static encode(v){let E=[];return Object.keys(v).forEach(function(S){E.push(encodeURIComponent(S)+"="+encodeURIComponent(v[S]))}),E.join("&")}static decode(v){let E={};return v.split("&").forEach(function(S){let w=S.split("="),f=decodeURIComponent(w[0]),u=decodeURIComponent(w[1]);E[f]=u}),E}}I.exports=a},function(I,b,a){(function(p,v){const{URL:E}=a(27),S=a(21),w=a(49),f=a(39),u=a(5),r=u.Headers?u.Headers:p.Headers,e=a(69),i=a(71),t=a(73),s=a(74),l=a(76);class c{constructor({rp:d,redirect:h,body:g,session:O,mode:k,params:C={}}){this.rp=d,this.redirect=h,this.body=g,this.session=O,this.mode=k,this.params=C}static validateResponse(d){return Promise.resolve(d).then(this.parseResponse).then(this.errorResponse).then(this.matchRequest).then(this.validateStateParam).then(this.validateResponseMode).then(this.validateResponseParams).then(this.exchangeAuthorizationCode).then(this.validateIDToken).then(t.fromAuthResponse)}static parseResponse(d){let{redirect:h,body:g}=d;if(h&&g||!h&&!g)throw new l(400,"Invalid response mode");if(h){let O=new E(h),{search:k,hash:C}=O;if(k&&C||!k&&!C)throw new l(400,"Invalid response mode");k&&(d.params=e.decode(k.substring(1)),d.mode="query"),C&&(d.params=e.decode(C.substring(1)),d.mode="fragment")}return g&&(d.params=e.decode(g),d.mode="form_post"),d}static errorResponse(d){const h=d.params.error;if(h){const g={};g.error=h,g.error_description=d.params.error_description,g.error_uri=d.params.error_uri,g.state=d.params.state;const O=new Error(`AuthenticationResponse error: ${h}`);throw O.info=g,O}return d}static matchRequest(d){let{rp:h,params:g,session:O}=d,k=g.state,C=h.provider.configuration.issuer;if(!k)throw new Error("Missing state parameter in authentication response");let B=`${C}/requestHistory/${k}`,J=O[B];if(!J)throw new Error("Mismatching state parameter in authentication response");return d.request=JSON.parse(J),d}static validateStateParam(d){let h=new Uint8Array(d.request.state),g=d.params.state;return w.subtle.digest({name:"SHA-256"},h).then(O=>{if(g!==f(v.from(O)))throw new Error("Mismatching state parameter in authentication response");return d})}static validateResponseMode(d){if(d.request.response_type!=="code"&&d.mode==="query")throw new Error("Invalid response mode");return d}static validateResponseParams(d){let{request:h,params:g}=d,O=h.response_type.split(" ");return O.includes("code")&&S(g.code,"Missing authorization code in authentication response"),O.includes("id_token")&&S(g.id_token,"Missing id_token in authentication response"),O.includes("token")&&(S(g.access_token,"Missing access_token in authentication response"),S(g.token_type,"Missing token_type in authentication response")),d}static exchangeAuthorizationCode(d){let{rp:h,params:g,request:O}=d,k=g.code;if(!k||O.response_type!=="code")return Promise.resolve(d);let{provider:C,registration:B}=h,J=B.client_id,$=B.client_secret;if(!$)return Promise.reject(new Error("Client cannot exchange authorization code because it is not a confidential client"));let q=C.configuration.token_endpoint,K="POST",W=new r({"Content-Type":"application/x-www-form-urlencoded"}),A={grant_type:"authorization_code",code:k,redirect_uri:O.redirect_uri},R=B.token_endpoint_auth_method||"client_secret_basic";if(R==="client_secret_basic"){let x=new v(`${J}:${$}`).toString("base64");W.set("Authorization",`Basic ${x}`)}R==="client_secret_post"&&(A.client_id=J,A.client_secret=$);let N=e.encode(A);return u(q,{method:K,headers:W,body:N}).then(s("Error exchanging authorization code")).then(x=>x.json()).then(x=>(S(x.access_token,"Missing access_token in token response"),S(x.token_type,"Missing token_type in token response"),S(x.id_token,"Missing id_token in token response"),d.params=Object.assign(d.params,x),d))}static validateIDToken(d){return d.params.id_token?Promise.resolve(d).then(c.decryptIDToken).then(c.decodeIDToken).then(c.validateIssuer).then(c.validateAudience).then(c.resolveKeys).then(c.verifySignature).then(c.validateExpires).then(c.verifyNonce).then(c.validateAcr).then(c.validateAuthTime).then(c.validateAccessTokenHash).then(c.validateAuthorizationCodeHash):Promise.resolve(d)}static decryptIDToken(d){return Promise.resolve(d)}static decodeIDToken(d){let h=d.params.id_token;try{d.decoded=i.decode(h)}catch(g){const O=new l(400,"Error decoding ID Token");throw O.cause=g,O.info={id_token:h},O}return d}static validateIssuer(d){let h=d.rp.provider.configuration;if(d.decoded.payload.iss!==h.issuer)throw new Error("Mismatching issuer in ID Token");return d}static validateAudience(d){let h=d.rp.registration,{aud:g,azp:O}=d.decoded.payload;if(typeof g=="string"&&g!==h.client_id)throw new Error("Mismatching audience in id_token");if(Array.isArray(g)&&!g.includes(h.client_id))throw new Error("Mismatching audience in id_token");if(Array.isArray(g)&&!O)throw new Error("Missing azp claim in id_token");if(O&&O!==h.client_id)throw new Error("Mismatching azp claim in id_token");return d}static resolveKeys(d){let h=d.rp,g=h.provider,O=d.decoded;return Promise.resolve(g.jwks).then(k=>k||h.jwks()).then(k=>{if(O.resolveKeys(k))return Promise.resolve(d);throw new Error("Cannot resolve signing key for ID Token")})}static verifySignature(d){let h=d.decoded.header.alg,O=d.rp.registration.id_token_signed_response_alg||"RS256";if(h!==O)throw new Error(`Expected ID Token to be signed with ${O}`);return d.decoded.verify().then(k=>{if(!k)throw new Error("Invalid ID Token signature");return d})}static validateExpires(d){if(d.decoded.payload.exp<=Math.floor(Date.now()/1e3))throw new Error("Expired ID Token");return d}static verifyNonce(d){let h=new Uint8Array(d.request.nonce),g=d.decoded.payload.nonce;if(!g)throw new Error("Missing nonce in ID Token");return w.subtle.digest({name:"SHA-256"},h).then(O=>{if(g!==f(v.from(O)))throw new Error("Mismatching nonce in ID Token");return d})}static validateAcr(d){return d}static validateAuthTime(d){return d}static validateAccessTokenHash(d){return d}static validateAuthorizationCodeHash(d){return d}}I.exports=c}).call(this,a(20),a(41).Buffer)},function(I,b,a){const{JWT:p}=a(37),v=a(72);class E extends p{static get schema(){return v}}I.exports=E},function(I,b,a){const{JWTSchema:p}=a(37),v=p.extend({properties:{header:{},payload:{properties:{iss:{type:"string",format:"url"},sub:{type:"string",maxLength:255},auth_time:{type:"integer",format:"NumericDate"},nonce:{type:"string"},acr:{type:"string"},amr:{type:"array",items:{type:"string"}},azp:{type:"string",format:"StringOrURI"}},required:["iss","sub","aud","exp","iat"]}}});I.exports=v},function(I,b,a){const p=a(5),v=a(74),E=a(75);class S{constructor(f){this.credentialType=f.credentialType||"access_token",this.issuer=f.issuer,this.authorization=f.authorization||{},this.sessionKey=f.sessionKey,this.idClaims=f.idClaims,this.accessClaims=f.accessClaims}static from(f){return new S(f)}static fromAuthResponse(f){const u=a(19);let r=f.decoded&&f.decoded.payload||{},{rp:e}=f,i=e.registration,s=(e.defaults.authenticate||{}).credential_type||e.defaults.popToken?"pop_token":"access_token",l=f.session[u.SESSION_PRIVATE_KEY],c={credentialType:s,sessionKey:l,issuer:r.iss,idClaims:r,authorization:{client_id:i.client_id,access_token:f.params.access_token,id_token:f.params.id_token,refresh_token:f.params.refresh_token}};return S.from(c)}get fetch(){return(f,u)=>Promise.resolve().then(()=>this.hasCredentials()?this.fetchWithCredentials(f,u):p(f,u)).then(v("Error while fetching resource"))}bearerTokenFor(f){switch(this.credentialType){case"pop_token":return E.issueFor(f,this);default:return Promise.resolve(this.authorization[this.credentialType])}}hasCredentials(){switch(this.credentialType){case"pop_token":return!!this.authorization.id_token;default:return!!this.authorization[this.credentialType]}}fetchWithCredentials(f,u={}){return u.headers=u.headers||{},this.bearerTokenFor(f).then(r=>(u.headers.authorization=`Bearer ${r}`,p(f,u)))}}I.exports=S},function(I,b,a){function p(v="fetch error"){return E=>{if(E.status>=200&&E.status<300)return E;let S=`${v}: ${E.status} ${E.statusText}`,w=new Error(S);throw w.response=E,w.statusCode=E.status,w}}I.exports=p},function(I,b,a){const{URL:p}=a(27),{JWT:v,JWK:E}=a(37),S=3600;class w extends v{static issueFor(u,r){if(!u)throw new Error("Cannot issue PoPToken - missing resource server URI");if(!r.sessionKey)throw new Error("Cannot issue PoPToken - missing session key");if(!r.authorization.id_token)throw new Error("Cannot issue PoPToken - missing id token");let e=JSON.parse(r.sessionKey);return E.importKey(e).then(i=>{let t={aud:new p(u).origin,key:i,iss:r.authorization.client_id,id_token:r.authorization.id_token};return w.issue(t)}).then(i=>i.encode())}static issue(u){let{aud:r,iss:e,key:i}=u,t=i.alg,s=u.iat||Math.floor(Date.now()/1e3),l=u.max||S,c=s+l,P={alg:t},d={iss:e,aud:r,exp:c,iat:s,id_token:u.id_token,token_type:"pop"};return new w({header:P,payload:d,key:i.cryptoKey},{filter:!1})}}I.exports=w},function(I,b,a){b=I.exports=S;var p=a(77),v=a(78),E=b;function S(r,e,i){if(typeof r=="string"&&(r=E[r]),typeof r!="number")throw new TypeError("Non-numeric HTTP code");typeof e=="object"&&e!=null&&(i=e,e=null),p.call(this,e||v[r],i),this.code=r}S.prototype=Object.create(p.prototype,{constructor:{value:S,configurable:!0,writable:!0}}),S.prototype.name="HttpError",Object.defineProperties(S.prototype,{statusCode:u("code"),statusMessage:u("message"),status:{configurable:!0,get:function(){return this.code},set:function(r){Object.defineProperty(this,"status",{value:r,configurable:!0,enumerable:!0,writable:!0})}}}),S.prototype.toString=function(){return this.name+": "+this.code+" "+this.message};for(var w in v){var f=v[w];b[f.replace("'","").replace(/[- ]/g,"_").toUpperCase()]=+w}function u(r){return{configurable:!0,get:function(){return this[r]},set:function(e){return this[r]=e}}}},function(I,b){var a=Object.hasOwnProperty,p=Object.getPrototypeOf,v=Error.captureStackTrace;I.exports=E;function E(S,w){if(S&&typeof S=="object"?(w=S,S=void 0):this.message=S,w)for(var f in w)this[f]=w[f];a.call(this,"name")||(this.name=a.call(p(this),"name")?this.name:this.constructor.name),v&&!("stack"in this)&&v(this,this.constructor)}E.prototype=Object.create(Error.prototype,{constructor:{value:E,configurable:!0,writable:!0}}),E.prototype.name="StandardError"},function(I){I.exports=JSON.parse(`{"100":"Continue","101":"Switching Protocols","102":"Processing","200":"OK","201":"Created","202":"Accepted","203":"Non-Authoritative Information","204":"No Content","205":"Reset Content","206":"Partial Content","207":"Multi-Status","208":"Already Reported","226":"IM Used","300":"Multiple Choices","301":"Moved Permanently","302":"Found","303":"See Other","304":"Not Modified","305":"Use Proxy","307":"Temporary Redirect","308":"Permanent Redirect","400":"Bad Request","401":"Unauthorized","402":"Payment Required","403":"Forbidden","404":"Not Found","405":"Method Not Allowed","406":"Not Acceptable","407":"Proxy Authentication Required","408":"Request Timeout","409":"Conflict","410":"Gone","411":"Length Required","412":"Precondition Failed","413":"Payload Too Large","414":"URI Too Long","415":"Unsupported Media Type","416":"Range Not Satisfiable","417":"Expectation Failed","418":"I'm a teapot","421":"Misdirected Request","422":"Unprocessable Entity","423":"Locked","424":"Failed Dependency","425":"Unordered Collection","426":"Upgrade Required","428":"Precondition Required","429":"Too Many Requests","431":"Request Header Fields Too Large","500":"Internal Server Error","501":"Not Implemented","502":"Bad Gateway","503":"Service Unavailable","504":"Gateway Timeout","505":"HTTP Version Not Supported","506":"Variant Also Negotiates","507":"Insufficient Storage","508":"Loop Detected","509":"Bandwidth Limit Exceeded","510":"Not Extended","511":"Network Authentication Required"}`)},function(I,b,a){const{JSONSchema:p}=a(28),v=new p({type:"object",properties:{provider:{type:"object",properties:{name:{type:"string"},url:{type:"string",format:"uri"},configuration:{},jwks:{}},required:["url"]},defaults:{type:"object",properties:{popToken:{type:"boolean",default:!1},authenticate:{type:"object",properties:{redirect_uri:{type:"string",format:"uri"},response_type:{type:"string",default:"id_token token",enum:["code","token","id_token token","id_token token code"]},display:{type:"string",default:"page",enum:["page","popup"]},scope:{type:["string","array"],default:["openid"]}}},register:{}}},registration:{},store:{type:"object",default:{}}}});I.exports=v},function(I,b,a){var p=function(){function s(l,c){for(var P=0;P<c.length;P++){var d=c[P];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(l,d.key,d)}}return function(l,c,P){return c&&s(l.prototype,c),P&&s(l,P),l}}();function v(s,l){if(!(s instanceof l))throw new TypeError("Cannot call a class as a function")}function E(s,l){if(!s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return l&&(typeof l=="object"||typeof l=="function")?l:s}function S(s,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof l);s.prototype=Object.create(l&&l.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),l&&(Object.setPrototypeOf?Object.setPrototypeOf(s,l):s.__proto__=l)}var w=a(27),f=w.URL,u=a(37),r=u.JWT,e=u.JWK,i=3600,t=function(s){S(l,s);function l(){return v(this,l),E(this,(l.__proto__||Object.getPrototypeOf(l)).apply(this,arguments))}return p(l,null,[{key:"issueFor",value:function(P,d){if(!P)throw new Error("Cannot issue PoPToken - missing resource server URI");if(!d.sessionKey)throw new Error("Cannot issue PoPToken - missing session key");if(!d.authorization.id_token)throw new Error("Cannot issue PoPToken - missing id token");var h=JSON.parse(d.sessionKey);return e.importKey(h).then(function(g){var O={aud:new f(P).origin,key:g,iss:d.authorization.client_id,id_token:d.authorization.id_token};return l.issue(O)}).then(function(g){return g.encode()})}},{key:"issue",value:function(P){var d=P.aud,h=P.iss,g=P.key,O=g.alg,k=P.iat||Math.floor(Date.now()/1e3),C=P.max||i,B=k+C,J={alg:O},$={iss:h,aud:d,exp:B,iat:k,id_token:P.id_token,token_type:"pop"},q=new l({header:J,payload:$,key:g.cryptoKey},{filter:!1});return q}}]),l}(r);I.exports=t},function(I,b,a){a.r(b),a.d(b,"openIdpPopup",function(){return E}),a.d(b,"obtainSession",function(){return S}),a.d(b,"popupHandler",function(){return w});var p=a(10),v=a(6);function E(f){const e=window.screenX+(window.innerWidth-650)/2,i=window.screenY+(window.innerHeight-400)/2,t="width=".concat(650,",height=").concat(400,",left=").concat(e,",top=").concat(i);return window.open(f,"solid-auth-client",t)}function S(f,u,r){return new Promise((e,i)=>{const t=new p.Server(u,Object(v.originOf)(r.popupUri||""),w(f,r,s=>{t.stop(),e(s)}));t.start()})}function w(f,u,r){let{popupUri:e,callbackUri:i}=u;return async function(t){for(var s=arguments.length,l=new Array(s>1?s-1:0),c=1;c<s;c++)l[c-1]=arguments[c];switch(t){case"getAppOrigin":return window.location.origin;case"storage/getItem":return f.getItem(...l);case"storage/setItem":return f.setItem(...l);case"storage/removeItem":return f.removeItem(...l);case"getLoginOptions":return{popupUri:e,callbackUri:i};case"foundSession":r(...l)}}}}]).default}(pe)),pe.exports}var be=Se();const Ae=Oe(be);export{Ae as SolidAuthClient};
